<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flood Prevention Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom, #1a237e, #4fc3f7);
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex: 1;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
        }
        
        .map-container {
            flex: 7;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .info-panel {
            flex: 3;
            background-color: rgba(0, 0, 30, 0.7);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .map {
            width: 100%;
            height: 100%;
            position: relative;
            background: linear-gradient(to bottom, #4db6ac, #81c784);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .terrain {
            position: absolute;
            border-radius: 5px;
        }
        
        .river {
            bottom: 0;
            left: 30%;
            width: 200px;
            height: 40px;
            background: linear-gradient(to right, #0288d1, #29b6f6);
            border-radius: 20px;
        }
        
        .house {
            top: 20%;
            left: 60%;
            width: 80px;
            height: 70px;
            background: #8d6e63;
            position: absolute;
        }
        
        .house:before {
            content: '';
            position: absolute;
            top: -20px;
            left: 0;
            width: 0;
            height: 0;
            border-left: 40px solid transparent;
            border-right: 40px solid transparent;
            border-bottom: 20px solid #5d4037;
        }
        
        .mountain {
            bottom: 0;
            left: 10%;
            width: 150px;
            height: 120px;
            background: #78909c;
            clip-path: polygon(0 100%, 50% 0, 100% 100%);
        }
        
        .tree {
            position: absolute;
            width: 40px;
            height: 60px;
            bottom: 0;
        }
        
        .tree:before {
            content: '';
            position: absolute;
            top: -30px;
            left: 0;
            width: 40px;
            height: 40px;
            background: #2e7d32;
            border-radius: 50%;
        }
        
        .tree:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 15px;
            width: 10px;
            height: 30px;
            background: #5d4037;
        }
        
        .tree-1 {
            left: 20%;
        }
        
        .tree-2 {
            left: 80%;
        }
        
        .tree-3 {
            left: 40%;
        }
        
        .fact-point {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffeb3b, #ffc107);
            cursor: pointer;
            box-shadow: 0 0 15px #ffeb3b;
            animation: pulse 2s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            z-index: 5;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .character {
            position: absolute;
            width: 30px;
            height: 40px;
            background: #f44336;
            border-radius: 50% 50% 40% 40%;
            transition: transform 0.3s;
            z-index: 10;
        }
        
        .character:after {
            content: '';
            position: absolute;
            top: 25px;
            left: 5px;
            width: 20px;
            height: 25px;
            background: #2196f3;
            border-radius: 5px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding: 10px;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .control-btn:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 0.4);
        }
        
        .points-container {
            margin-bottom: 20px;
        }
        
        .points {
            font-size: 2rem;
            font-weight: bold;
            color: #4caf50;
        }
        
        .facts-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .fact-item {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            display: flex;
            align-items: center;
        }
        
        .fact-item.discovered {
            background: rgba(76, 175, 80, 0.3);
        }
        
        .fact-icon {
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .completion-message {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .completion-message.show {
            display: block;
            animation: fadeIn 1s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .key-instructions {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        /* Fact Popup Styles */
        .fact-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            background: linear-gradient(to bottom, #2196f3, #1a237e);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: none;
            border: 2px solid #29b6f6;
        }
        
        .fact-popup.show {
            display: block;
            animation: popIn 0.5s;
        }
        
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .popup-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffeb3b;
        }
        
        .popup-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .popup-content {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .popup-points {
            font-size: 1.2rem;
            color: #4caf50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .popup-footer {
            display: flex;
            justify-content: flex-end;
        }
        
        .popup-btn {
            padding: 10px 20px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .popup-btn:hover {
            background: #388e3c;
            transform: translateY(-2px);
        }
        
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 90;
            display: none;
        }
        
        .overlay.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Flood Prevention Explorer</h1>
            <p class="subtitle">Discover flood prevention facts and earn points as you explore!</p>
        </header>
        
        <div class="content">
            <div class="map-container">
                <div class="map">
                    <!-- Terrain elements -->
                    <div class="terrain river"></div>
                    <div class="terrain house"></div>
                    <div class="terrain mountain"></div>
                    <div class="terrain tree tree-1"></div>
                    <div class="terrain tree tree-2"></div>
                    <div class="terrain tree tree-3"></div>
                    
                    <!-- Fact points -->
                    <div class="fact-point" style="top: 20%; left: 20%;" data-fact="1">1</div>
                    <div class="fact-point" style="top: 60%; left: 40%;" data-fact="2">2</div>
                    <div class="fact-point" style="top: 30%; left: 70%;" data-fact="3">3</div>
                    <div class="fact-point" style="bottom: 20%; left: 50%;" data-fact="4">4</div>
                    <div class="fact-point" style="top: 50%; left: 10%;" data-fact="5">5</div>
                    
                    <!-- Character -->
                    <div class="character" id="character"></div>
                </div>
                
                <div class="controls">
                    <button class="control-btn" id="up">↑</button>
                    <div>
                        <button class="control-btn" id="left">←</button>
                        <button class="control-btn" id="down">↓</button>
                        <button class="control-btn" id="right">→</button>
                    </div>
                </div>
                <div class="key-instructions">Use the <b>Up</b>, <b>Down</b>, <b>Left</b>, and <b>Right</b> arrow keys on your keyboard to navigate the map and discover all facts!</div>
            </div>
            
            <div class="info-panel">
                <div class="points-container">
                    <h2>Your Score</h2>
                    <div class="points" id="points">0</div>
                </div>
                
                <h2>Flood Prevention Facts</h2>
                <div class="facts-list">
                    <div class="fact-item" id="fact-1">
                        <span class="fact-icon">🔍</span>
                        <span>Plant trees to reduce soil erosion and absorb excess water</span>
                    </div>
                    <div class="fact-item" id="fact-2">
                        <span class="fact-icon">🔍</span>
                        <span>Create rain gardens to capture and filter stormwater</span>
                    </div>
                    <div class="fact-item" id="fact-3">
                        <span class="fact-icon">🔍</span>
                        <span>Install proper drainage systems around your home</span>
                    </div>
                    <div class="fact-item" id="fact-4">
                        <span class="fact-icon">🔍</span>
                        <span>Use permeable paving materials for driveways and walkways</span>
                    </div>
                    <div class="fact-item" id="fact-5">
                        <span class="fact-icon">🔍</span>
                        <span>Elevate critical utilities like electrical panels and HVAC systems</span>
                    </div>
                </div>
                
                <div class="completion-message" id="completion-message">
                    <h2>Congratulations! 🎉</h2>
                    <p>You've discovered all the flood prevention facts!</p>
                    <p>Your total score: <span id="total-score">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Fact Popup -->
    <div class="overlay" id="overlay"></div>
    <div class="fact-popup" id="fact-popup">
        <div class="popup-header">
            <div class="popup-title">Fact Discovered!</div>
            <button class="popup-close" id="popup-close">×</button>
        </div>
        <div class="popup-content" id="popup-content">
            Fact content will appear here...
        </div>
        <div class="popup-points" id="popup-points">+10 points</div>
        <div class="popup-footer">
            <button class="popup-btn" id="popup-mark-read">
                <span>Mark as Read</span>
                <span>✓</span>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const character = document.getElementById('character');
            const pointsElement = document.getElementById('points');
            const factPoints = document.querySelectorAll('.fact-point');
            const completionMessage = document.getElementById('completion-message');
            const totalScoreElement = document.getElementById('total-score');
            
            // Popup elements
            const overlay = document.getElementById('overlay');
            const factPopup = document.getElementById('fact-popup');
            const popupContent = document.getElementById('popup-content');
            const popupPoints = document.getElementById('popup-points');
            const popupClose = document.getElementById('popup-close');
            const popupMarkRead = document.getElementById('popup-mark-read');
            
            // Initial character position (center of map)
            let charX = 350;
            let charY = 200;
            character.style.left = `${charX}px`;
            character.style.top = `${charY}px`;
            
            // Game state
            let points = 0;
            const factsDiscovered = {
                1: false,
                2: false,
                3: false,
                4: false,
                5: false
            };
            
            // Fact details
            const factPointsData = {
                1: { 
                    points: 20, 
                    title: "Tree Planting for Erosion Control",
                    text: "Planting trees is one of the most effective ways to prevent flooding. Trees absorb thousands of gallons of stormwater through their roots, and their canopies break the force of rain. Their root systems also hold soil in place, reducing erosion that can clog waterways.",
                    longText: "A single mature tree can intercept over 1,000 gallons of rainfall annually. Forested areas can reduce runoff by up to 10 times compared to paved areas. Native species with deep root systems are particularly effective at stabilizing soil and creating channels for water absorption."
                },
                2: { 
                    points: 15, 
                    title: "Rain Gardens",
                    text: "Rain gardens are shallow depressions planted with native vegetation that capture and filter stormwater runoff. They allow 30% more water to soak into the ground compared to conventional lawns.",
                    longText: "Properly designed rain gardens can remove up to 90% of nutrients and chemicals and 80% of sediments from rainwater runoff. They are typically 4-8 inches deep and use a special soil mix that allows for rapid water infiltration. Plants chosen for rain gardens must tolerate both periodic flooding and dry conditions."
                },
                3: { 
                    points: 10, 
                    title: "Proper Drainage Systems",
                    text: "Effective drainage systems direct water away from structures and prevent pooling. French drains, channel drains, and proper grading can significantly reduce flood risk to properties.",
                    longText: "A well-designed drainage system should move water at least 10 feet away from your foundation. The ground should slope away from your house at a minimum of 6 inches over the first 10 feet. Regular maintenance of gutters and downspouts is crucial - they should be cleaned at least twice a year and direct water 5-10 feet away from your home's foundation."
                },
                4: { 
                    points: 15, 
                    title: "Permeable Paving",
                    text: "Permeable pavements allow stormwater to infiltrate through the surface into underlying layers, reducing runoff by up to 80% compared to traditional impervious surfaces.",
                    longText: "Permeable paving options include pervious concrete, porous asphalt, interlocking pavers, and plastic grid systems filled with gravel or grass. These systems typically have a base layer of crushed stone that temporarily stores water before it infiltrates into the soil. They can reduce the need for traditional stormwater infrastructure and help recharge groundwater supplies."
                },
                5: { 
                    points: 20, 
                    title: "Elevating Utilities",
                    text: "Elevating electrical systems, HVAC units, water heaters, and other critical utilities can prevent costly damage during floods. The recommended height is at least 1 foot above the projected flood elevation for your area.",
                    longText: "According to FEMA, elevating utilities can reduce flood damage by up to 80%. Electrical panels should be raised to at least 12 inches above the Base Flood Elevation. Fuel tanks should be properly anchored and elevated to prevent tearing away and causing contamination. Washers and dryers can be elevated on masonry platforms, and HVAC systems can be moved to upper floors or elevated on platforms."
                }
            };
            
            // Current fact being displayed
            let currentFact = null;
            
            // Move character function
            function moveCharacter(dx, dy) {
                const mapRect = document.querySelector('.map').getBoundingClientRect();
                const charWidth = character.offsetWidth;
                const charHeight = character.offsetHeight;
                
                // Calculate new position
                let newX = charX + dx;
                let newY = charY + dy;
                
                // Constrain to map boundaries
                newX = Math.max(0, Math.min(newX, mapRect.width - charWidth));
                newY = Math.max(0, Math.min(newY, mapRect.height - charHeight));
                
                // Update position
                charX = newX;
                charY = newY;
                character.style.left = `${charX}px`;
                character.style.top = `${charY}px`;
                
                // Check for fact discovery
                checkFactDiscovery();
            }
            
            // Check if character is near a fact point
            function checkFactDiscovery() {
                factPoints.forEach(point => {
                    const factNum = point.getAttribute('data-fact');
                    if (factsDiscovered[factNum]) return; // Skip if already discovered
                    
                    const pointRect = point.getBoundingClientRect();
                    const charRect = character.getBoundingClientRect();
                    
                    // Calculate distance between character and fact point
                    const dx = (charRect.left + charRect.width/2) - (pointRect.left + pointRect.width/2);
                    const dy = (charRect.top + charRect.height/2) - (pointRect.top + pointRect.height/2);
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    
                    // If close enough, discover the fact
                    if (distance < 50) {
                        discoverFact(factNum);
                    }
                });
            }
            
            // Discover a fact
            function discoverFact(factNum) {
                if (factsDiscovered[factNum]) return;
                
                factsDiscovered[factNum] = true;
                const factData = factPointsData[factNum];
                
                // Update points
                points += factData.points;
                pointsElement.textContent = points;
                
                // Show the fact popup
                showFactPopup(factNum, factData);
                
                // Visual feedback for the fact point
                const factPoint = document.querySelector(`.fact-point[data-fact="${factNum}"]`);
                factPoint.style.background = 'radial-gradient(circle, #4caf50, #2e7d32)';
                factPoint.style.boxShadow = '0 0 15px #4caf50';
                factPoint.style.animation = 'none';
                
                // Check if all facts are discovered
                if (Object.values(factsDiscovered).every(val => val)) {
                    showCompletionMessage();
                }
            }
            
            // Show fact popup
            function showFactPopup(factNum, factData) {
                currentFact = factNum;
                popupContent.innerHTML = `
                    <h3>${factData.title}</h3>
                    <p>${factData.text}</p>
                    <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <p><strong>More details:</strong> ${factData.longText}</p>
                    </div>
                `;
                popupPoints.textContent = `+${factData.points} points earned!`;
                factPopup.classList.add('show');
                overlay.classList.add('show');
            }
            
            // Hide fact popup
            function hideFactPopup() {
                factPopup.classList.remove('show');
                overlay.classList.remove('show');
            }
            
            // Mark fact as read
            function markFactAsRead() {
                if (!currentFact) return;
                
                const factElement = document.getElementById(`fact-${currentFact}`);
                factElement.classList.add('discovered');
                factElement.querySelector('.fact-icon').textContent = '✅';
                
                hideFactPopup();
            }
            
            // Show completion message
            function showCompletionMessage() {
                totalScoreElement.textContent = points;
                completionMessage.classList.add('show');
                // Save points to localStorage for educationmodule1.html
                localStorage.setItem('vrmodule-points', points);
                // After a short delay, close or redirect
                setTimeout(function() {
                    if (window.opener && !window.opener.closed) {
                        window.opener.location.href = 'educationmodule1.html';
                        window.close();
                    } else {
                        window.location.href = 'educationmodule1.html';
                    }
                }, 2000); // 2 seconds for user to see completion
            }
            
            // Button controls
            document.getElementById('up').addEventListener('click', () => moveCharacter(0, -20));
            document.getElementById('down').addEventListener('click', () => moveCharacter(0, 20));
            document.getElementById('left').addEventListener('click', () => moveCharacter(-20, 0));
            document.getElementById('right').addEventListener('click', () => moveCharacter(20, 0));
            
            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowUp':
                        moveCharacter(0, -20);
                        break;
                    case 'ArrowDown':
                        moveCharacter(0, 20);
                        break;
                    case 'ArrowLeft':
                        moveCharacter(-20, 0);
                        break;
                    case 'ArrowRight':
                        moveCharacter(20, 0);
                        break;
                }
            });
            
            // Popup events
            popupClose.addEventListener('click', hideFactPopup);
            popupMarkRead.addEventListener('click', markFactAsRead);
            overlay.addEventListener('click', hideFactPopup);
            
            // Initialize character position
            moveCharacter(0, 0);
        });
    </script>
</body>
</html>