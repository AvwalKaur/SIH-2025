<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disaster Quest - Emergency Escape Room</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --light-bg: #f5f7fb;

            /* User palette to use across cards/overlays */
            --p1: #309ad4;
            --p2: #e69c42;
            --p3: #ea8d99;
            --p4: #faafa4;
            --p5: #e2afd3;
            --p6: #c8e5f3;
            --p7: #fae8c7;

            --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
            --transition: all 0.25s ease;
            --glass: rgba(255, 255, 255, 0.72);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: var(--light-bg);
            color: var(--text-dark);
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-weight: 400;
            font-style: normal;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
            padding: 20px;
            letter-spacing: -0.01em;
            line-height: 1.6;
        }
        
        /* Back to main page button */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 1000;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(18, 38, 63, 0.15);
            text-decoration: none;
            color: white;
        }

        .back-button i {
            font-size: 1rem;
        }
        
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            min-height: 90vh;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .game-info {
            flex: 1;
            padding: 24px;
            border-right: 1px solid rgba(16, 24, 32, 0.06);
            background: linear-gradient(180deg, #fff, #fbfdff);
            overflow-y: auto;
        }
        
        .game-area {
            flex: 2.5;
            padding: 24px;
            display: flex;
            flex-direction: column;
            background: var(--light-bg);
        }
        
        header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(26, 115, 232, 0.08);
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 12px;
            text-align: center;
            font-size: 32px;
            font-weight: 600;
            font-family: "Playfair Display", Georgia, serif;
            text-shadow: none;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }
        
        h2 {
            color: var(--primary);
            margin: 20px 0 12px;
            border-bottom: 2px solid rgba(26, 115, 232, 0.08);
            padding-bottom: 8px;
            font-weight: 600;
            font-family: "Playfair Display", Georgia, serif;
            font-size: 22px;
            letter-spacing: -0.01em;
            line-height: 1.3;
        }
        
        h3 {
            color: var(--primary);
            margin: 12px 0;
            font-weight: 600;
            font-family: "Playfair Display", Georgia, serif;
            font-size: 18px;
            letter-spacing: -0.01em;
            line-height: 1.4;
        }
        
        .subtitle {
            color: var(--p1);
            margin: 0;
            font-weight: 500;
            font-family: "Inter", sans-serif;
            letter-spacing: 0.02em;
            text-transform: uppercase;
            font-size: 0.9rem;
        }
        
        .rules-list, .points-list {
            margin-left: 20px;
            margin-bottom: 20px;
        }
        
        li {
            margin-bottom: 10px;
            line-height: 1.5;
            color: var(--text-dark);
        }
        
        .stats {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--p6);
            box-shadow: var(--shadow);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(16, 24, 32, 0.06);
        }
        
        .stat-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .status-item {
            text-align: center;
            padding: 16px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 2px solid var(--p6);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .status-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(18, 38, 63, 0.12);
        }
        
        .status-label {
            font-size: 0.9rem;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .status-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            font-family: "Inter", sans-serif;
        }
        
        .escape-room {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            border: 2px solid rgba(26, 115, 232, 0.1);
            box-shadow: var(--shadow);
        }
        
        .scenario-header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            background: linear-gradient(135deg, var(--p6), var(--p7));
            padding: 20px;
            border-radius: 12px;
            border: 2px solid rgba(26, 115, 232, 0.1);
        }
        
        .scenario-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), #ea6f7b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-right: 20px;
            box-shadow: var(--shadow);
        }
        
        .scenario-details {
            flex-grow: 1;
        }
        
        .scenario-details h3 {
            margin: 0 0 8px 0;
            color: var(--primary);
        }
        
        .scenario-details p {
            color: var(--text-dark);
            opacity: 0.8;
            margin: 0;
        }
        
        .room-view {
            height: 200px;
            background: linear-gradient(135deg, var(--p1), var(--p6));
            border-radius: 12px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
            border: 2px solid rgba(26, 115, 232, 0.2);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .puzzle-area {
            background: linear-gradient(135deg, var(--light-bg), #fff);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid rgba(26, 115, 232, 0.1);
            box-shadow: var(--shadow);
        }
        
        .puzzle-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--text-dark);
            background: var(--card-bg);
            padding: 16px;
            border-radius: 10px;
            border-left: 4px solid var(--p1);
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .option {
            padding: 16px;
            background: var(--card-bg);
            border: 2px solid var(--p1);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .option:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(26, 115, 232, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .option:hover:before {
            left: 100%;
        }
        
        .option:hover {
            background: var(--p1);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 115, 232, 0.2);
        }
        
        .kit-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .kit-item {
            padding: 12px;
            background: var(--card-bg);
            border: 2px solid var(--p2);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .kit-item:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(230, 156, 66, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .kit-item:hover:before {
            left: 100%;
        }
        
        .kit-item.selected {
            background: var(--p2);
            color: white;
            font-weight: 700;
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(230, 156, 66, 0.3);
        }
        
        .kit-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(230, 156, 66, 0.2);
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        
        button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover:before {
            left: 100%;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(18, 38, 63, 0.15);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: var(--shadow);
        }
        
        .danger {
            background: linear-gradient(90deg, var(--accent), #f56b77);
        }
        
        .danger:hover {
            background: linear-gradient(90deg, #f56b77, var(--accent));
        }
        
        .success {
            background: linear-gradient(90deg, var(--secondary), #2ea044);
        }
        
        .success:hover {
            background: linear-gradient(90deg, #2ea044, var(--secondary));
        }
        
        .warning {
            background: linear-gradient(90deg, var(--warning), #f1c40f);
        }
        
        .warning:hover {
            background: linear-gradient(90deg, #f1c40f, var(--warning));
        }
        
        /* Animation keyframes */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out;
        }
        
        .log {
            background: var(--card-bg);
            height: 200px;
            border-radius: 12px;
            padding: 16px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 0.95rem;
            border: 2px solid rgba(26, 115, 232, 0.1);
            box-shadow: var(--shadow);
        }
        
        .log-entry {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(16, 24, 32, 0.06);
            line-height: 1.5;
        }
        
        .log-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .success-text {
            color: var(--secondary);
            font-weight: 600;
        }
        
        .danger-text {
            color: var(--accent);
            font-weight: 600;
        }
        
        .warning-text {
            color: var(--warning);
            font-weight: 600;
        }
        
        .info-text {
            color: var(--primary);
            font-weight: 600;
        }
        
        .puzzle-text-log {
            color: var(--p5);
            font-weight: 600;
        }
        
        .restart-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, var(--secondary), #2ea044);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .restart-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .restart-btn:hover:before {
            left: 100%;
        }
        
        .restart-btn:hover {
            background: linear-gradient(90deg, #2ea044, var(--secondary));
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(18, 38, 63, 0.15);
        }
        
        .progress-container {
            height: 24px;
            background: var(--light-bg);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 2px solid rgba(26, 115, 232, 0.1);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
        }
        
        .timer-warning {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { 
                background: var(--card-bg);
                border-color: rgba(26, 115, 232, 0.1);
            }
            50% { 
                background: rgba(242, 92, 84, 0.1);
                border-color: var(--accent);
            }
            100% { 
                background: var(--card-bg);
                border-color: rgba(26, 115, 232, 0.1);
            }
        }
        
        /* Responsive design */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
            
            .game-info {
                border-right: none;
                border-bottom: 1px solid rgba(16, 24, 32, 0.06);
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .container {
                border-radius: 12px;
                margin-top: 60px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .actions, .options, .kit-items {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .back-button {
                top: 10px;
                left: 10px;
                padding: 10px 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <a href="../gamified-learning.html" class="back-button">
        <i class="fas fa-arrow-left"></i>
        Back to Games
    </a>
    <div class="container">
        <div class="game-info">
            <header>
                <h1><i class="fas fa-shield-alt"></i> Disaster Quest</h1>
                <p class="subtitle">Emergency Escape Room Challenge</p>
            </header>
            
            <h2><i class="fas fa-gamepad"></i> How to Play</h2>
            <ul class="rules-list">
                <li>Solve puzzles to evacuate safely from disaster scenarios</li>
                <li>Choose the right emergency kit items for each situation</li>
                <li>Find safe exit routes before time runs out</li>
                <li>Make decisions under pressure with limited information</li>
                <li>Each correct choice earns points and advances your escape</li>
                <li>Different scenario each time you play</li>
            </ul>
            
            <h2><i class="fas fa-trophy"></i> Scoring System</h2>
            <ul class="points-list">
                <li><strong>+100 points</strong> for successful escape</li>
                <li><strong>+50 points</strong> for each correct puzzle solved</li>
                <li><strong>+25 points</strong> for each essential kit item selected</li>
                <li><strong>+75 points</strong> for time remaining when escaping</li>
                <li><strong>-30 points</strong> for incorrect choices</li>
                <li><strong>Bonus points</strong> for finding hidden safety items</li>
            </ul>
            
            <div class="stats">
                <h2><i class="fas fa-chart-line"></i> Your Statistics</h2>
                <div class="stat-item">
                    <span><i class="fas fa-star"></i> Highest Score:</span>
                    <span id="high-score">0</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-door-open"></i> Escapes Completed:</span>
                    <span id="escapes-completed">0</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-puzzle-piece"></i> Puzzles Solved:</span>
                    <span id="puzzles-solved">0</span>
                </div>
                <div class="stat-item">
                    <span><i class="fas fa-clock"></i> Average Time:</span>
                    <span id="average-time">0s</span>
                </div>
            </div>
            
            <button class="restart-btn" onclick="initGame()">
                <i class="fas fa-redo"></i> Start New Challenge
            </button>
        </div>
        
        <div class="game-area">
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-label"><i class="fas fa-clock"></i> Time Remaining</div>
                    <div class="status-value" id="time">05:00</div>
                </div>
                <div class="status-item">
                    <div class="status-label"><i class="fas fa-puzzle-piece"></i> Puzzles Solved</div>
                    <div class="status-value" id="puzzles">0/3</div>
                </div>
                <div class="status-item">
                    <div class="status-label"><i class="fas fa-shield-alt"></i> Safety Score</div>
                    <div class="status-value" id="safety">100%</div>
                </div>
                <div class="status-item">
                    <div class="status-label"><i class="fas fa-star"></i> Total Score</div>
                    <div class="status-value" id="score">0</div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="escape-room">
                <div class="scenario-header">
                    <div class="scenario-icon" id="scenario-icon">🔥</div>
                    <div class="scenario-details">
                        <h3 id="scenario-name">Office Fire Emergency</h3>
                        <p id="scenario-difficulty">Difficulty: Moderate</p>
                    </div>
                </div>
                
                <div class="room-view" id="room-view">
                    12th Floor Office - Fire on South Side
                </div>
                
                <div class="puzzle-area">
                    <div class="puzzle-text" id="puzzle-text">
                        The fire alarm is sounding and smoke is visible under the door. 
                        Choose the most essential items from the emergency kit for this situation.
                    </div>
                    
                    <div class="kit-items">
                        <div class="kit-item" onclick="selectItem(0)">
                            <i class="fas fa-fire-extinguisher"></i> Fire Extinguisher
                        </div>
                        <div class="kit-item" onclick="selectItem(1)">
                            <i class="fas fa-tint"></i> Water Bottle
                        </div>
                        <div class="kit-item" onclick="selectItem(2)">
                            <i class="fas fa-shield-alt"></i> Emergency Blanket
                        </div>
                        <div class="kit-item" onclick="selectItem(3)">
                            <i class="fas fa-head-side-mask"></i> Dust Mask
                        </div>
                    </div>
                    
                    <div class="options">
                        <div class="option" onclick="solvePuzzle(0)">
                            <i class="fas fa-walking"></i> Exit through main hallway
                        </div>
                        <div class="option" onclick="solvePuzzle(1)">
                            <i class="fas fa-stairs"></i> Use emergency staircase
                        </div>
                        <div class="option" onclick="solvePuzzle(2)">
                            <i class="fas fa-window-maximize"></i> Wait by window for rescue
                        </div>
                        <div class="option" onclick="solvePuzzle(3)">
                            <i class="fas fa-elevator"></i> Take elevator to ground floor
                        </div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="warning" onclick="useItem()">
                        <i class="fas fa-hand-holding"></i> Use Selected Item
                    </button>
                    <button class="success" onclick="attemptEscape()">
                        <i class="fas fa-running"></i> Attempt Escape
                    </button>
                </div>
            </div>
            
            <div class="log" id="log">
                <div class="log-entry info-text">
                    <i class="fas fa-bell"></i> Fire alarm activated! Emergency protocol initiated.
                </div>
                <div class="log-entry warning-text">
                    <i class="fas fa-exclamation-triangle"></i> Smoke detected on the floor. Evacuation necessary.
                </div>
                <div class="log-entry">
                    <i class="fas fa-info-circle"></i> Choose the right items and escape route to survive.
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            time: 300, // 5 minutes in seconds
            puzzlesSolved: 0,
            totalPuzzles: 3,
            safety: 100,
            score: 0,
            progress: 0,
            gameOver: false,
            timer: null,
            scenario: null,
            selectedItem: null,
            currentPuzzle: 0,
            hintsUsed: 0,
            highScore: parseInt(localStorage.getItem('highScore')) || 0,
            escapesCompleted: parseInt(localStorage.getItem('escapesCompleted')) || 0,
            puzzlesSolvedTotal: parseInt(localStorage.getItem('puzzlesSolvedTotal')) || 0,
            totalTimePlayed: parseInt(localStorage.getItem('totalTimePlayed')) || 0
        };
        
        // Escape room scenarios
        const scenarios = [
            {
                name: "Office Fire Emergency",
                icon: "🔥",
                difficulty: "Moderate",
                description: "Fire has broken out on the 12th floor of an office building. Smoke is spreading rapidly through ventilation systems.",
                room: "12th Floor Office - Fire on South Side",
                puzzles: [
                    {
                        question: "The fire alarm is sounding and smoke is visible under the door. Choose the most essential items from the emergency kit for this situation.",
                        hint: "Breathing protection and fire suppression tools are most important in fire emergencies.",
                        items: ["Fire Extinguisher", "Water Bottle", "Emergency Blanket", "Dust Mask"],
                        correctItems: [0, 3], // Fire Extinguisher and Dust Mask
                        options: [
                            "Exit through main hallway",
                            "Use emergency staircase",
                            "Wait by window for rescue",
                            "Take elevator to ground floor"
                        ],
                        correctOption: 1, // Use emergency staircase
                        solution: "In a high-rise fire, always use emergency staircases instead of elevators which may fail or open on fire floors."
                    },
                    {
                        question: "You encounter smoke filling the staircase. What should you do?",
                        hint: "Remember that smoke rises and sound travels far in emergencies.",
                        items: ["Wet Cloth", "Flashlight", "Whistle", "First Aid Kit"],
                        correctItems: [0, 2], // Wet Cloth and Whistle
                        options: [
                            "Go back to your office",
                            "Continue down through the smoke",
                            "Crawl low under the smoke",
                            "Break a window for air"
                        ],
                        correctOption: 2, // Crawl low under the smoke
                        solution: "Smoke rises, so the cleanest air will be near the floor. Crawl to avoid smoke inhalation."
                    },
                    {
                        question: "You've reached the lobby but the main exit is blocked by fire. Choose items to help you safely exit.",
                        hint: "Focus on tools that can create new exits or provide protection during escape.",
                        items: ["Emergency Hammer", "Phone Charger", "Fire Blanket", "Water Bottle"],
                        correctItems: [0, 2], // Emergency Hammer and Fire Blanket
                        options: [
                            "Look for another exit",
                            "Try to put out the fire",
                            "Break a window to escape",
                            "Hide in a bathroom"
                        ],
                        correctOption: 0, // Look for another exit
                        solution: "Always look for alternative exits rather than attempting dangerous escapes through windows."
                    }
                ]
            },
            {
                name: "Earthquake Survival",
                icon: "🏚️",
                difficulty: "High",
                description: "A major earthquake has struck while you were in a supermarket. Structural damage and falling hazards everywhere.",
                room: "Damaged Supermarket - Aftershocks Expected",
                puzzles: [
                    {
                        question: "The shaking has stopped but aftershocks are likely. Choose protective items.",
                        items: ["Hard Hat", "First Aid Kit", "Water Bottle", "Dust Mask"],
                        correctItems: [0, 3], // Hard Hat and Dust Mask
                        options: [
                            "Run for the nearest exit",
                            "Take cover under sturdy furniture",
                            "Move to the center of the room",
                            "Climb over debris to escape"
                        ],
                        correctOption: 1, // Take cover under sturdy furniture
                        solution: "After an earthquake, protect yourself from aftershocks by taking cover under sturdy furniture."
                    },
                    {
                        question: "You need to navigate through damaged aisles. Choose items to help you.",
                        items: ["Flashlight", "Gloves", "Emergency Whistle", "Multi-tool"],
                        correctItems: [0, 1], // Flashlight and Gloves
                        options: [
                            "Move quickly toward sunlight",
                            "Test each step before moving",
                            "Yell for help continuously",
                            "Climb over shelves"
                        ],
                        correctOption: 1, // Test each step before moving
                        solution: "After an earthquake, structures may be unstable. Move carefully and test surfaces before putting weight on them."
                    },
                    {
                        question: "You're near an exit but it's partially blocked by collapsed debris. Choose items to help clear a path.",
                        items: ["Crowbar", "Fire Extinguisher", "Rope", "Water Bottle"],
                        correctItems: [0, 2], // Crowbar and Rope
                        options: [
                            "Start removing debris carefully",
                            "Try to squeeze through the opening",
                            "Look for another way out",
                            "Wait for rescue teams"
                        ],
                        correctOption: 0, // Start removing debris carefully
                        solution: "If safe to do so, carefully clear a path while being mindful of unstable structures that could collapse further."
                    }
                ]
            },
            {
                name: "Flood Evacuation",
                icon: "🌊",
                difficulty: "Very High",
                description: "Flash flooding has trapped you in a ground-level library. Water is rising rapidly with no signs of stopping.",
                room: "Flooding Library - Water Rising Quickly",
                puzzles: [
                    {
                        question: "Water is entering under the doors. Choose items to help you stay safe and dry.",
                        items: ["Life Jacket", "Waterproof Bag", "Flashlight", "Emergency Blanket"],
                        correctItems: [0, 1], // Life Jacket and Waterproof Bag
                        options: [
                            "Move to higher ground within the building",
                            "Try to swim to safety",
                            "Barricade the doors",
                            "Break a window to escape"
                        ],
                        correctOption: 0, // Move to higher ground within the building
                        solution: "In flooding situations, always move to higher ground rather than attempting to swim through unknown waters."
                    },
                    {
                        question: "You've reached the second floor but water is still rising. Choose items to signal for help.",
                        items: ["Flashlight", "Whistle", "Mirror", "Emergency Flares"],
                        correctItems: [0, 1, 2, 3], // All items are useful for signaling
                        options: [
                            "Wait silently for rescue",
                            "Make noise to attract attention",
                            "Create a visible signal from window",
                            "Try to reach the roof"
                        ],
                        correctOption: 2, // Create a visible signal from window
                        solution: "In flood situations, make yourself visible to rescuers rather than attempting dangerous moves to higher areas."
                    },
                    {
                        question: "Rescue boats are visible but distant. Choose items to help attract their attention.",
                        items: ["Flashlight", "Colorful Clothing", "Whistle", "Water Bottle"],
                        correctItems: [0, 1, 2], // Flashlight, Colorful Clothing, Whistle
                        options: [
                            "Jump into the water and swim toward them",
                            "Wave and signal from your safe position",
                            "Throw items to create splashes",
                            "Break windows to make noise"
                        ],
                        correctOption: 1, // Wave and signal from your safe position
                        solution: "Never enter floodwaters. Signal from safe ground as moving water can be deceptively powerful."
                    }
                ]
            }
        ];
        
        // Initialize the game
        function initGame() {
            // Clear previous timer
            clearInterval(gameState.timer);
            
            // Select random scenario
            gameState.scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            
            // Reset game state
            gameState.time = 300;
            gameState.puzzlesSolved = 0;
            gameState.safety = 100;
            gameState.score = 0;
            gameState.progress = 0;
            gameState.gameOver = false;
            gameState.selectedItem = null;
            gameState.currentPuzzle = 0;
            
            // Update scenario display
            document.getElementById('scenario-icon').textContent = gameState.scenario.icon;
            document.getElementById('scenario-name').textContent = gameState.scenario.name;
            document.getElementById('scenario-difficulty').textContent = `Difficulty: ${gameState.scenario.difficulty}`;
            document.getElementById('room-view').textContent = gameState.scenario.room;
            
            // Load first puzzle
            loadPuzzle(0);
            
            // Clear log and add initial message
            const log = document.getElementById('log');
            log.innerHTML = '';
            addLog(`Emergency alert: ${gameState.scenario.name}`, 'info');
            addLog(gameState.scenario.description, 'warning');
            addLog("Solve puzzles to escape safely. Time is critical!", 'danger');
            
            // Update display
            updateDisplay();
            
            // Update statistics
            updateStatistics();
            
            // Start timer
            startTimer();
        }
        
        // Load a puzzle
        function loadPuzzle(index) {
            if (index >= gameState.scenario.puzzles.length) return;
            
            const puzzle = gameState.scenario.puzzles[index];
            gameState.currentPuzzle = index;
            
            document.getElementById('puzzle-text').textContent = puzzle.question;
            
            // Create kit items
            const kitItems = document.querySelector('.kit-items');
            kitItems.innerHTML = '';
            puzzle.items.forEach((item, i) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'kit-item';
                
                // Add appropriate icons for different items
                const icons = {
                    'Fire Extinguisher': 'fas fa-fire-extinguisher',
                    'Water Bottle': 'fas fa-tint',
                    'Emergency Blanket': 'fas fa-shield-alt',
                    'Dust Mask': 'fas fa-head-side-mask',
                    'Hard Hat': 'fas fa-hard-hat',
                    'First Aid Kit': 'fas fa-medkit',
                    'Life Jacket': 'fas fa-life-ring',
                    'Waterproof Bag': 'fas fa-shopping-bag',
                    'Flashlight': 'fas fa-flashlight',
                    'Whistle': 'fas fa-bullhorn',
                    'Mirror': 'fas fa-mirror',
                    'Emergency Flares': 'fas fa-fire',
                    'Wet Cloth': 'fas fa-tshirt',
                    'Phone Charger': 'fas fa-battery-three-quarters',
                    'Emergency Hammer': 'fas fa-hammer',
                    'Fire Blanket': 'fas fa-shield-alt',
                    'Gloves': 'fas fa-hand-paper',
                    'Multi-tool': 'fas fa-tools',
                    'Crowbar': 'fas fa-wrench',
                    'Rope': 'fas fa-rope',
                    'Colorful Clothing': 'fas fa-tshirt'
                };
                
                const iconClass = icons[item] || 'fas fa-box';
                itemElement.innerHTML = `<i class="${iconClass}"></i> ${item}`;
                itemElement.onclick = () => selectItem(i);
                itemElement.title = `Click to select ${item}`;
                kitItems.appendChild(itemElement);
            });
            
            // Create options
            const options = document.querySelector('.options');
            options.innerHTML = '';
            puzzle.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                
                // Add appropriate icons for different actions
                const actionIcons = {
                    'Exit through main hallway': 'fas fa-walking',
                    'Use emergency staircase': 'fas fa-stairs',
                    'Wait by window for rescue': 'fas fa-window-maximize',
                    'Take elevator to ground floor': 'fas fa-elevator',
                    'Go back to your office': 'fas fa-arrow-left',
                    'Continue down through the smoke': 'fas fa-arrow-down',
                    'Crawl low under the smoke': 'fas fa-child',
                    'Break a window for air': 'fas fa-hammer',
                    'Look for another exit': 'fas fa-search',
                    'Try to put out the fire': 'fas fa-fire-extinguisher',
                    'Break a window to escape': 'fas fa-hammer',
                    'Hide in a bathroom': 'fas fa-door-closed',
                    'Take cover under sturdy furniture': 'fas fa-chair',
                    'Move to the center of the room': 'fas fa-arrows-alt',
                    'Climb over debris to escape': 'fas fa-mountain',
                    'Move quickly toward sunlight': 'fas fa-sun',
                    'Test each step before moving': 'fas fa-walking',
                    'Yell for help continuously': 'fas fa-bullhorn',
                    'Climb over shelves': 'fas fa-mountain',
                    'Start removing debris carefully': 'fas fa-hand-paper',
                    'Try to squeeze through the opening': 'fas fa-compress',
                    'Look for another way out': 'fas fa-search',
                    'Wait for rescue teams': 'fas fa-clock',
                    'Move to higher ground within the building': 'fas fa-arrow-up',
                    'Try to swim to safety': 'fas fa-swimmer',
                    'Barricade the doors': 'fas fa-shield-alt',
                    'Break a window to escape': 'fas fa-hammer',
                    'Stay indoors with supplies': 'fas fa-home',
                    'Help clear emergency routes': 'fas fa-road',
                    'Venture out unnecessarily': 'fas fa-walking',
                    'Wait silently for rescue': 'fas fa-volume-mute',
                    'Make noise to attract attention': 'fas fa-bullhorn',
                    'Create a visible signal from window': 'fas fa-flag',
                    'Try to reach the roof': 'fas fa-arrow-up',
                    'Jump into the water and swim toward them': 'fas fa-swimmer',
                    'Wave and signal from your safe position': 'fas fa-hand-paper',
                    'Throw items to create splashes': 'fas fa-baseball-ball',
                    'Break windows to make noise': 'fas fa-hammer'
                };
                
                const iconClass = actionIcons[option] || 'fas fa-arrow-right';
                optionElement.innerHTML = `<i class="${iconClass}"></i> ${option}`;
                optionElement.onclick = () => solvePuzzle(i);
                optionElement.title = `Click to choose: ${option}`;
                options.appendChild(optionElement);
            });
            
            // Reset selected item
            gameState.selectedItem = null;
        }
        
        // Update the game display
        function updateDisplay() {
            const minutes = Math.floor(gameState.time / 60);
            const seconds = gameState.time % 60;
            document.getElementById('time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Add warning animation when time is low
            if (gameState.time < 60) {
                document.getElementById('time').parentElement.classList.add('timer-warning');
            } else {
                document.getElementById('time').parentElement.classList.remove('timer-warning');
            }
            
            document.getElementById('puzzles').textContent = `${gameState.puzzlesSolved}/${gameState.totalPuzzles}`;
            document.getElementById('safety').textContent = `${gameState.safety}%`;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('progress-bar').style.width = `${gameState.progress}%`;
        }
        
        // Update statistics panel
        function updateStatistics() {
            document.getElementById('high-score').textContent = gameState.highScore;
            document.getElementById('escapes-completed').textContent = gameState.escapesCompleted;
            document.getElementById('puzzles-solved').textContent = gameState.puzzlesSolvedTotal;
            
            const avgTime = gameState.escapesCompleted > 0 
                ? Math.round(gameState.totalTimePlayed / gameState.escapesCompleted) 
                : 0;
            document.getElementById('average-time').textContent = `${avgTime}s`;
        }
        
        // Start the countdown timer
        function startTimer() {
            gameState.timer = setInterval(() => {
                if (gameState.gameOver) {
                    clearInterval(gameState.timer);
                    return;
                }
                
                gameState.time--;
                
                if (gameState.time <= 0) {
                    addLog("Time has run out! Escape failed.", 'danger');
                    endGame();
                    return;
                }
                
                // Random event chance
                if (Math.random() > 0.97) {
                    const events = [
                        {msg: 'Structural integrity compromised! Safety decreasing.', safety: -10, type: 'danger'},
                        {msg: 'Found a helpful item!', score: +25, type: 'success'},
                        {msg: 'Aftershock! Time lost regrouping.', time: -30, type: 'warning'},
                        {msg: 'Discovered a shortcut!', time: +20, type: 'info'},
                    ];
                    
                    const event = events[Math.floor(Math.random() * events.length)];
                    addLog(event.msg, event.type);
                    
                    if (event.safety) gameState.safety += event.safety;
                    if (event.score) gameState.score += event.score;
                    if (event.time) gameState.time += event.time;
                }
                
                updateDisplay();
            }, 1000);
        }
        
        // Add a message to the log
        function addLog(message, type = 'info') {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}-text`;
            
            // Add appropriate icons based on message type
            const icons = {
                'success': 'fas fa-check-circle',
                'danger': 'fas fa-exclamation-triangle',
                'warning': 'fas fa-exclamation-circle',
                'info': 'fas fa-info-circle',
                'puzzle': 'fas fa-puzzle-piece'
            };
            
            const icon = icons[type] || 'fas fa-circle';
            entry.innerHTML = `<i class="${icon}"></i> ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            
            // Add animation effect
            entry.style.opacity = '0';
            entry.style.transform = 'translateY(10px)';
            setTimeout(() => {
                entry.style.transition = 'all 0.3s ease';
                entry.style.opacity = '1';
                entry.style.transform = 'translateY(0)';
            }, 50);
        }
        
        // Select an item from the kit
        function selectItem(index) {
            const items = document.querySelectorAll('.kit-item');
            items.forEach(item => item.classList.remove('selected'));
            items[index].classList.add('selected');
            gameState.selectedItem = index;
            
            const puzzle = gameState.scenario.puzzles[gameState.currentPuzzle];
            const itemName = puzzle.items[index];
            addLog(`Selected: ${itemName}`, 'info');
            
            // Add visual feedback
            items[index].style.transform = 'scale(1.05)';
            setTimeout(() => {
                items[index].style.transform = '';
            }, 200);
        }
        
        // Use the selected item
        function useItem() {
            if (gameState.selectedItem === null) {
                addLog("Please select an item first before using it!", 'warning');
                
                // Highlight kit items to draw attention
                const items = document.querySelectorAll('.kit-item');
                items.forEach(item => {
                    item.style.animation = 'pulse 0.5s ease-in-out';
                    setTimeout(() => {
                        item.style.animation = '';
                    }, 500);
                });
                return;
            }
            
            const puzzle = gameState.scenario.puzzles[gameState.currentPuzzle];
            const isCorrect = puzzle.correctItems.includes(gameState.selectedItem);
            const itemName = puzzle.items[gameState.selectedItem];
            
            if (isCorrect) {
                addLog(`Excellent choice! The ${itemName} is very useful in this situation.`, 'success');
                gameState.score += 25;
                
                // Visual success feedback
                const selectedItem = document.querySelector('.kit-item.selected');
                if (selectedItem) {
                    selectedItem.style.background = 'linear-gradient(135deg, var(--secondary), #2ea044)';
                    selectedItem.style.color = 'white';
                }
            } else {
                addLog(`The ${itemName} isn't the best choice for this emergency situation.`, 'danger');
                gameState.safety -= 10;
                gameState.time -= 20;
                
                // Visual error feedback
                const selectedItem = document.querySelector('.kit-item.selected');
                if (selectedItem) {
                    selectedItem.style.background = 'linear-gradient(135deg, var(--accent), #f56b77)';
                    selectedItem.style.color = 'white';
                }
            }
            
            updateDisplay();
        }
        
        // Solve the current puzzle
        function solvePuzzle(optionIndex) {
            const puzzle = gameState.scenario.puzzles[gameState.currentPuzzle];
            const isCorrect = (optionIndex === puzzle.correctOption);
            
            if (isCorrect) {
                addLog("Correct! " + puzzle.solution, 'success');
                gameState.puzzlesSolved++;
                gameState.score += 50;
                gameState.progress = (gameState.puzzlesSolved / gameState.totalPuzzles) * 100;
                
                // Load next puzzle or end game if completed
                if (gameState.puzzlesSolved >= gameState.totalPuzzles) {
                    addLog("All puzzles solved! Ready to attempt escape.", 'success');
                } else {
                    loadPuzzle(gameState.currentPuzzle + 1);
                }
            } else {
                addLog("Incorrect choice. Try again.", 'danger');
                gameState.safety -= 15;
                gameState.time -= 30;
            }
            
            updateDisplay();
        }
        
        // Get a hint for the current puzzle
        function getHint() {
            if (gameState.hintsUsed >= 3) {
                addLog("No more hints available! You need to rely on your knowledge now.", 'warning');
                
                // Shake the hint button to show it's disabled
                const hintBtn = document.querySelector('.control-btn:nth-child(2)');
                if (hintBtn) {
                    hintBtn.style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        hintBtn.style.animation = '';
                    }, 500);
                }
                return;
            }
            
            const puzzle = gameState.scenario.puzzles[gameState.currentPuzzle];
            if (puzzle.hint) {
                addLog(`💡 Hint: ${puzzle.hint}`, 'info');
                gameState.hintsUsed++;
                gameState.score -= 5; // Small penalty for using hints
                
                // Update hint button to show remaining hints
                const hintBtn = document.querySelector('.control-btn:nth-child(2)');
                if (hintBtn) {
                    hintBtn.innerHTML = `<i class="fas fa-lightbulb"></i> Hint (${3 - gameState.hintsUsed} left)`;
                    if (gameState.hintsUsed === 3) {
                        hintBtn.style.opacity = '0.5';
                        hintBtn.style.cursor = 'not-allowed';
                    }
                }
                
                updateDisplay();
            } else {
                addLog("No hint available for this puzzle. Think carefully about emergency procedures!", 'info');
            }
        }
        
        // Attempt to escape
        function attemptEscape() {
            if (gameState.puzzlesSolved < gameState.totalPuzzles) {
                addLog("You haven't solved all puzzles yet! Keep working.", 'warning');
                return;
            }
            
            addLog("Attempting escape...", 'info');
            
            // Simulate escape attempt
            setTimeout(() => {
                const escapeSuccess = gameState.safety > 50;
                
                if (escapeSuccess) {
                    const timeBonus = gameState.time * 2;
                    gameState.score += 100 + timeBonus;
                    addLog(`Escape successful! Time bonus: +${timeBonus} points`, 'success');
                    addLog("You've survived the disaster!", 'success');
                } else {
                    addLog("Escape failed! Safety level too low.", 'danger');
                }
                
                endGame();
            }, 2000);
        }
        
        // End the game
        function endGame() {
            gameState.gameOver = true;
            clearInterval(gameState.timer);
            
            // Update statistics
            gameState.puzzlesSolvedTotal += gameState.puzzlesSolved;
            gameState.totalTimePlayed += (300 - gameState.time);
            
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
            }
            
            if (gameState.puzzlesSolved >= gameState.totalPuzzles && gameState.safety > 50) {
                gameState.escapesCompleted++;
            }
            
            // Save to localStorage
            localStorage.setItem('highScore', gameState.highScore);
            localStorage.setItem('escapesCompleted', gameState.escapesCompleted);
            localStorage.setItem('puzzlesSolvedTotal', gameState.puzzlesSolvedTotal);
            localStorage.setItem('totalTimePlayed', gameState.totalTimePlayed);
            
            // Display results
            addLog(`GAME OVER! Final score: ${gameState.score}`, 'info');
            addLog(`Puzzles solved: ${gameState.puzzlesSolved}/${gameState.totalPuzzles}`, 'info');
            addLog(`Safety level: ${gameState.safety}%`, gameState.safety > 50 ? 'success' : 'danger');
            
            updateStatistics();
        }
        
        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>