<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disaster Mind (iThrive Sim) 🧠</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --light-bg: #f5f7fb;

            /* user palette to use across cards/overlays */
            --p1: #309ad4;
            --p2: #e69c42;
            --p3: #ea8d99;
            --p4: #faafa4;
            --p5: #e2afd3;
            --p6: #c8e5f3;
            --p7: #fae8c7;

            --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
            --transition: all 0.25s ease;
            --glass: rgba(255, 255, 255, 0.72);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: var(--light-bg);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 20px;
            font-family: "Ubuntu", sans-serif;
            font-weight: 400;
            font-style: normal;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            display: grid;
            grid-template-columns: 380px 1fr;
            max-width: 1400px;
            margin: 0 auto;
            gap: 20px;
        }
        
        .game-info {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(16, 24, 32, 0.03);
            height: fit-content;
        }
        
        .game-area {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(16, 24, 32, 0.03);
            display: flex;
            flex-direction: column;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(26, 115, 232, 0.08);
        }
        
        h1 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        h2 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        h3 {
            font-size: 1.2rem;
            color: var(--text-dark);
            margin: 15px 0 10px;
            font-weight: 600;
        }
        
        .rules-list, .points-list {
            margin-left: 0;
            margin-bottom: 20px;
            padding-left: 0;
            list-style: none;
        }
        
        .rules-list li, .points-list li {
            margin-bottom: 8px;
            line-height: 1.6;
            padding: 8px 12px;
            background: rgba(26, 115, 232, 0.03);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
            position: relative;
        }
        
        .rules-list li::before {
            content: "📋";
            margin-right: 8px;
        }
        
        .points-list li::before {
            content: "🎯";
            margin-right: 8px;
        }
        
        .stats {
            background: linear-gradient(180deg, #fff, #fbfdff);
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(26, 115, 232, 0.03);
            border-radius: 8px;
            font-weight: 500;
        }
        
        .stat-item:last-child {
            margin-bottom: 0;
        }
        
        .status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .status-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(180deg, #fff, #fbfdff);
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .status-item div:first-child {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .status-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .scenario {
            background: linear-gradient(180deg, #fff, #fbfdff);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            flex-grow: 1;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .scenario-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(26, 115, 232, 0.03);
            padding: 15px;
            border-radius: 10px;
        }
        
        .scenario-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--p1), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-right: 15px;
            color: white;
            box-shadow: 0 4px 12px rgba(48, 154, 212, 0.3);
        }
        
        .scenario-details {
            flex-grow: 1;
        }
        
        .scenario-text {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            background: rgba(26, 115, 232, 0.03);
            padding: 15px;
            border-radius: 10px;
            color: var(--text-dark);
        }
        
        .objectives {
            background: rgba(26, 115, 232, 0.03);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .objective {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 8px;
            background: var(--card-bg);
            transition: var(--transition);
        }
        
        .objective:hover {
            background: rgba(26, 115, 232, 0.05);
        }
        
        .objective-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--primary);
            border-radius: 4px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .objective.completed .objective-checkbox {
            background: var(--secondary);
            border-color: var(--secondary);
        }
        
        .objective.completed .objective-checkbox::after {
            content: "✓";
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(18, 38, 63, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .danger {
            background: linear-gradient(90deg, var(--accent), #e74c3c);
        }
        
        .success {
            background: linear-gradient(90deg, var(--secondary), #2ea044);
        }
        
        .warning {
            background: linear-gradient(90deg, var(--warning), var(--p2));
        }
        
        .community {
            background: linear-gradient(90deg, var(--p5), var(--p3));
        }
        
        .log {
            background: linear-gradient(180deg, #fff, #fbfdff);
            height: 200px;
            border-radius: 12px;
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 0.9rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .log-entry {
            margin-bottom: 10px;
            padding: 8px 10px;
            border-radius: 8px;
            line-height: 1.5;
            background: rgba(26, 115, 232, 0.03);
            border-left: 3px solid transparent;
        }
        
        .success-text {
            color: var(--secondary);
            border-left-color: var(--secondary);
        }
        
        .danger-text {
            color: var(--accent);
            border-left-color: var(--accent);
        }
        
        .warning-text {
            color: var(--warning);
            border-left-color: var(--warning);
        }
        
        .info-text {
            color: var(--primary);
            border-left-color: var(--primary);
        }
        
        .critical-text {
            color: var(--p3);
            border-left-color: var(--p3);
        }
        
        .restart-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, var(--secondary), #2ea044);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
            box-shadow: var(--shadow);
        }
        
        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(52, 168, 83, 0.25);
        }
        
        .progress-container {
            height: 18px;
            background: rgba(26, 115, 232, 0.08);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .fema-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(90deg, var(--accent), #e74c3c);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(242, 92, 84, 0.3);
        }
        
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .game-info {
                order: 2;
            }
            
            .game-area {
                order: 1;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .back-button {
                top: 10px;
                left: 10px;
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .container {
                margin-top: 55px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .actions {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .status-item {
                padding: 12px;
            }
            
            .status-value {
                font-size: 1.2rem;
            }
            
            .scenario-header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .scenario-icon {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                gap: 12px;
            }
            
            .game-info,
            .game-area {
                padding: 16px;
            }
            
            .status-bar {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
        }

        /* Back to main page button */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 1000;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(18, 38, 63, 0.15);
            text-decoration: none;
            color: white;
        }

        .back-button i {
            font-size: 1rem;
        }

        /* Adjust container margin to account for back button */
        .container {
            margin-top: 60px;
        }
    </style>
</head>
<body>
    <a href="../gamified-learning.html" class="back-button">
        <i class="fas fa-arrow-left"></i>
        Back to Dashboard
    </a>
    <div class="container">
        <div class="game-info">
            <header>
                <h1>Disaster Mind 🧠</h1>
                <p>FEMA-supported disaster management simulation</p>
                <div class="fema-badge">FEMA Supported</div>
            </header>
            
            <h2>Game Rules</h2>
            <ul class="rules-list">
                <li>Manage resources and make critical decisions during disasters</li>
                <li>Balance immediate response with long-term recovery</li>
                <li>Consider ethical dilemmas and community impact</li>
                <li>Complete objectives to advance through scenarios</li>
                <li>Each decision affects your effectiveness score</li>
                <li>Scenarios change each time you play for replayability</li>
            </ul>
            
            <h2>Scoring System</h2>
            <ul class="points-list">
                <li>+100 points for completing primary objectives</li>
                <li>+50 points for efficient resource management</li>
                <li>+75 points for minimizing casualties</li>
                <li>+60 points for maintaining public trust</li>
                <li>+40 points for completing secondary objectives</li>
                <li>Bonus points for quick response times</li>
            </ul>
            
            <div class="stats">
                <h2>Your Statistics</h2>
                <div class="stat-item">
                    <span>Highest Score:</span>
                    <span id="high-score">0</span>
                </div>
                <div class="stat-item">
                    <span>Scenarios Completed:</span>
                    <span id="scenarios-completed">0</span>
                </div>
                <div class="stat-item">
                    <span>Response Effectiveness:</span>
                    <span id="response-effectiveness">0%</span>
                </div>
                <div class="stat-item">
                    <span>Critical Decisions Made:</span>
                    <span id="decisions-made">0</span>
                </div>
            </div>
            
            <button class="restart-btn" onclick="initGame()">🔄 New Scenario</button>
        </div>
        
        <div class="game-area">
            <div class="status-bar">
                <div class="status-item">
                    <div>Resources</div>
                    <div class="status-value" id="resources">$50,000</div>
                </div>
                <div class="status-item">
                    <div>Public Trust</div>
                    <div class="status-value" id="trust">75%</div>
                </div>
                <div class="status-item">
                    <div>Time</div>
                    <div class="status-value" id="time">10:00</div>
                </div>
                <div class="status-item">
                    <div>Score</div>
                    <div class="status-value" id="score">0</div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="scenario">
                <div class="scenario-header">
                    <div class="scenario-icon" id="scenario-icon">🌀</div>
                    <div class="scenario-details">
                        <h3 id="scenario-name">Hurricane Response</h3>
                        <p id="scenario-difficulty">Difficulty: Moderate</p>
                    </div>
                </div>
                
                <div class="scenario-text" id="scenario-text">
                    A Category 3 hurricane is making landfall in a coastal community of 25,000 people. 
                    You are the emergency manager responsible for coordinating response efforts. 
                    Evacuation orders were issued 24 hours ago, but approximately 30% of residents remain in the danger zone.
                </div>
                
                <div class="objectives">
                    <h3>Primary Objectives</h3>
                    <div class="objective" id="obj1">
                        <div class="objective-checkbox"></div>
                        <div>Ensure emergency shelters are operational</div>
                    </div>
                    <div class="objective" id="obj2">
                        <div class="objective-checkbox"></div>
                        <div>Coordinate search and rescue operations</div>
                    </div>
                    <div class="objective" id="obj3">
                        <div class="objective-checkbox"></div>
                        <div>Restore critical infrastructure</div>
                    </div>
                    
                    <h3>Secondary Objectives</h3>
                    <div class="objective" id="obj4">
                        <div class="objective-checkbox"></div>
                        <div>Establish communication with isolated communities</div>
                    </div>
                    <div class="objective" id="obj5">
                        <div class="objective-checkbox"></div>
                        <div>Coordinate with neighboring jurisdictions</div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="danger" onclick="makeDecision('evacuate')">🚁 Emergency Evacuation</button>
                    <button class="warning" onclick="makeDecision('resources')">📦 Deploy Resources</button>
                    <button onclick="makeDecision('coordinate')">📡 Coordinate Agencies</button>
                    <button class="success" onclick="makeDecision('assess')">🔍 Damage Assessment</button>
                </div>
            </div>
            
            <div class="log" id="log">
                <div class="log-entry info-text">Welcome to Disaster Mind. You are now the Emergency Manager.</div>
                <div class="log-entry warning-text">Hurricane making landfall. Evacuation orders are in effect.</div>
                <div class="log-entry">30% of residents remain in danger zones. Prepare for response operations.</div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            resources: 50000,
            trust: 75,
            time: 600, // 10 minutes in seconds
            score: 0,
            progress: 0,
            gameOver: false,
            timer: null,
            scenario: null,
            objectives: [],
            highScore: parseInt(localStorage.getItem('highScore')) || 0,
            scenariosCompleted: parseInt(localStorage.getItem('scenariosCompleted')) || 0,
            responseEffectiveness: parseInt(localStorage.getItem('responseEffectiveness')) || 0,
            decisionsMade: parseInt(localStorage.getItem('decisionsMade')) || 0
        };
        
        // Disaster scenarios
        const scenarios = [
            {
                name: "Hurricane Response",
                icon: "🌀",
                difficulty: "Moderate",
                description: "A Category 3 hurricane is making landfall in a coastal community of 25,000 people. You are the emergency manager responsible for coordinating response efforts. Evacuation orders were issued 24 hours ago, but approximately 30% of residents remain in the danger zone.",
                resources: 50000,
                trust: 75,
                objectives: [
                    { id: "obj1", text: "Ensure emergency shelters are operational", completed: false, primary: true },
                    { id: "obj2", text: "Coordinate search and rescue operations", completed: false, primary: true },
                    { id: "obj3", text: "Restore critical infrastructure", completed: false, primary: true },
                    { id: "obj4", text: "Establish communication with isolated communities", completed: false, primary: false },
                    { id: "obj5", text: "Coordinate with neighboring jurisdictions", completed: false, primary: false }
                ]
            },
            {
                name: "Wildfire Crisis",
                icon: "🔥",
                difficulty: "High",
                description: "A fast-moving wildfire is threatening a community of 15,000 people. High winds are causing rapid spread, and multiple neighborhoods are under evacuation orders. You must manage limited resources while ensuring public safety.",
                resources: 45000,
                trust: 70,
                objectives: [
                    { id: "obj1", text: "Establish evacuation routes and centers", completed: false, primary: true },
                    { id: "obj2", text: "Deploy fire suppression resources", completed: false, primary: true },
                    { id: "obj3", text: "Coordinate air support operations", completed: false, primary: true },
                    { id: "obj4", text: "Protect critical infrastructure", completed: false, primary: false },
                    { id: "obj5", text: "Manage public information and warnings", completed: false, primary: false }
                ]
            },
            {
                name: "Earthquake Response",
                icon: "🏚️",
                difficulty: "Very High",
                description: "A 7.2 magnitude earthquake has struck a metropolitan area of 500,000 people. Widespread damage to infrastructure is reported. Multiple casualties are expected. You must coordinate emergency response across multiple agencies.",
                resources: 75000,
                trust: 65,
                objectives: [
                    { id: "obj1", text: "Coordinate urban search and rescue teams", completed: false, primary: true },
                    { id: "obj2", text: "Establish emergency medical services", completed: false, primary: true },
                    { id: "obj3", text: "Assess structural safety of buildings", completed: false, primary: true },
                    { id: "obj4", text: "Restore water and power systems", completed: false, primary: false },
                    { id: "obj5", text: "Manage donor resources and volunteers", completed: false, primary: false }
                ]
            },
            {
                name: "Flood Emergency",
                icon: "💧",
                difficulty: "Moderate",
                description: "Record rainfall has caused severe flooding in a river basin community. Multiple levees are at risk of failure. Thousands of residents are isolated by floodwaters. You must manage response and recovery operations.",
                resources: 60000,
                trust: 80,
                objectives: [
                    { id: "obj1", text: "Coordinate water rescue operations", completed: false, primary: true },
                    { id: "obj2", text: "Monitor levee integrity and reinforce if needed", completed: false, primary: true },
                    { id: "obj3", text: "Establish emergency supply distribution", completed: false, primary: true },
                    { id: "obj4", text: "Coordinate with Army Corps of Engineers", completed: false, primary: false },
                    { id: "obj5", text: "Plan for long-term recovery operations", completed: false, primary: false }
                ]
            },
            {
                name: "Pandemic Response",
                icon: "🦠",
                difficulty: "Extreme",
                description: "A novel respiratory virus is spreading rapidly through the population. Healthcare systems are becoming overwhelmed. You must balance public health measures with economic and social considerations.",
                resources: 100000,
                trust: 60,
                objectives: [
                    { id: "obj1", text: "Establish testing and contact tracing", completed: false, primary: true },
                    { id: "obj2", text: "Secure healthcare system capacity", completed: false, primary: true },
                    { id: "obj3", text: "Coordinate vaccine distribution", completed: false, primary: true },
                    { id: "obj4", text: "Manage public communication and trust", completed: false, primary: false },
                    { id: "obj5", text: "Balance economic impacts with public health", completed: false, primary: false }
                ]
            }
        ];
        
        // Initialize the game
        function initGame() {
            // Clear previous timer
            clearInterval(gameState.timer);
            
            // Select random scenario
            gameState.scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            
            // Reset game state
            gameState.resources = gameState.scenario.resources;
            gameState.trust = gameState.scenario.trust;
            gameState.time = 600;
            gameState.score = 0;
            gameState.progress = 0;
            gameState.gameOver = false;
            gameState.objectives = JSON.parse(JSON.stringify(gameState.scenario.objectives));
            
            // Update scenario display
            document.getElementById('scenario-icon').textContent = gameState.scenario.icon;
            document.getElementById('scenario-name').textContent = gameState.scenario.name;
            document.getElementById('scenario-difficulty').textContent = `Difficulty: ${gameState.scenario.difficulty}`;
            document.getElementById('scenario-text').textContent = gameState.scenario.description;
            
            // Update objectives
            gameState.objectives.forEach(obj => {
                const objectiveElement = document.getElementById(obj.id);
                if (objectiveElement) {
                    objectiveElement.className = 'objective';
                    objectiveElement.querySelector('.objective-checkbox').className = 'objective-checkbox';
                    objectiveElement.lastChild.textContent = obj.text;
                }
            });
            
            // Clear log and add initial message
            const log = document.getElementById('log');
            log.innerHTML = '';
            addLog(`Scenario: ${gameState.scenario.name}`, 'info');
            addLog(`Difficulty: ${gameState.scenario.difficulty}`, 'warning');
            addLog(gameState.scenario.description, 'info');
            addLog("Make critical decisions to manage the emergency response.", 'critical');
            
            // Update display
            updateDisplay();
            
            // Update statistics
            updateStatistics();
            
            // Start timer
            startTimer();
        }
        
        // Update the game display
        function updateDisplay() {
            document.getElementById('resources').textContent = `$${gameState.resources.toLocaleString()}`;
            document.getElementById('trust').textContent = `${gameState.trust}%`;
            
            const minutes = Math.floor(gameState.time / 60);
            const seconds = gameState.time % 60;
            document.getElementById('time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('progress-bar').style.width = `${gameState.progress}%`;
        }
        
        // Update statistics panel
        function updateStatistics() {
            document.getElementById('high-score').textContent = gameState.highScore;
            document.getElementById('scenarios-completed').textContent = gameState.scenariosCompleted;
            document.getElementById('response-effectiveness').textContent = `${gameState.responseEffectiveness}%`;
            document.getElementById('decisions-made').textContent = gameState.decisionsMade;
        }
        
        // Start the countdown timer
        function startTimer() {
            gameState.timer = setInterval(() => {
                if (gameState.gameOver) {
                    clearInterval(gameState.timer);
                    return;
                }
                
                gameState.time--;
                
                if (gameState.time <= 0) {
                    endGame();
                    return;
                }
                
                // Random event chance
                if (Math.random() > 0.95) {
                    const events = [
                        {msg: 'Secondary emergency reported! Additional resources needed.', resources: -5000, trust: -5, type: 'danger'},
                        {msg: 'Federal assistance approved! Additional funding available.', resources: +10000, type: 'success'},
                        {msg: 'Media criticism affecting public trust.', trust: -8, type: 'warning'},
                        {msg: 'Community volunteers organizing support efforts.', trust: +5, type: 'info'},
                        {msg: 'Infrastructure failure causing response delays.', resources: -3000, trust: -3, type: 'critical'}
                    ];
                    
                    const event = events[Math.floor(Math.random() * events.length)];
                    addLog(event.msg, event.type);
                    
                    if (event.resources) gameState.resources += event.resources;
                    if (event.trust) gameState.trust += event.trust;
                }
                
                updateDisplay();
            }, 1000);
        }
        
        // Add a message to the log
        function addLog(message, type = 'info') {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}-text`;
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // Process player decisions
        function makeDecision(decision) {
            if (gameState.gameOver) return;
            
            let resourceChange = 0;
            let trustChange = 0;
            let progressChange = 0;
            let scoreChange = 0;
            let message = '';
            
            switch(decision) {
                case 'evacuate':
                    if (gameState.resources >= 10000) {
                        resourceChange = -10000;
                        trustChange = 5;
                        progressChange = 15;
                        scoreChange = 75;
                        message = 'Emergency evacuation operations launched. Saving lives is the priority.';
                        completeObjective(0); // First primary objective
                    } else {
                        trustChange = -10;
                        message = 'Insufficient resources for evacuation operations. Seek additional funding.';
                    }
                    break;
                    
                case 'resources':
                    if (gameState.resources >= 8000) {
                        resourceChange = -8000;
                        trustChange = 3;
                        progressChange = 12;
                        scoreChange = 60;
                        message = 'Resources deployed to affected areas. Response efforts accelerating.';
                        completeObjective(1); // Second primary objective
                    } else {
                        trustChange = -5;
                        message = 'Resource deployment delayed due to budget constraints.';
                    }
                    break;
                    
                case 'coordinate':
                    if (gameState.resources >= 5000) {
                        resourceChange = -5000;
                        trustChange = 7;
                        progressChange = 10;
                        scoreChange = 50;
                        message = 'Agency coordination improved. Multi-organizational response enhanced.';
                        completeObjective(4); // Coordination objective
                    } else {
                        trustChange = -3;
                        message = 'Inter-agency coordination limited by resource constraints.';
                    }
                    break;
                    
                case 'assess':
                    if (gameState.resources >= 3000) {
                        resourceChange = -3000;
                        trustChange = 2;
                        progressChange = 8;
                        scoreChange = 40;
                        message = 'Damage assessment underway. Better situational awareness achieved.';
                        completeObjective(2); // Third primary objective
                    } else {
                        trustChange = -2;
                        message = 'Damage assessment limited by available resources.';
                    }
                    break;
            }
            
            // Apply changes
            gameState.resources = Math.max(0, gameState.resources + resourceChange);
            gameState.trust = Math.min(100, Math.max(0, gameState.trust + trustChange));
            gameState.progress = Math.min(100, gameState.progress + progressChange);
            gameState.score += scoreChange;
            gameState.decisionsMade++;
            
            // Add log message
            addLog(message, trustChange > 0 ? 'success' : 'warning');
            
            // Check for game completion
            if (gameState.progress >= 100) {
                addLog('Primary mission objectives completed!', 'success');
                endGame();
            }
            
            updateDisplay();
        }
        
        // Complete an objective
        function completeObjective(index) {
            if (index < gameState.objectives.length && !gameState.objectives[index].completed) {
                gameState.objectives[index].completed = true;
                const objectiveElement = document.getElementById(gameState.objectives[index].id);
                if (objectiveElement) {
                    objectiveElement.classList.add('completed');
                }
                
                // Add score for completing objective
                const points = gameState.objectives[index].primary ? 100 : 40;
                gameState.score += points;
                
                addLog(`Objective completed: ${gameState.objectives[index].text}`, 'success');
            }
        }
        
        // End the game
        function endGame() {
            gameState.gameOver = true;
            clearInterval(gameState.timer);
            
            // Calculate final score
            const trustBonus = gameState.trust * 2;
            const resourceBonus = gameState.resources / 100;
            const timeBonus = gameState.time;
            
            gameState.score += trustBonus + resourceBonus + timeBonus;
            
            // Calculate effectiveness
            const completedObjectives = gameState.objectives.filter(obj => obj.completed && obj.primary).length;
            gameState.responseEffectiveness = Math.round((completedObjectives / 3) * 100);
            
            // Update statistics
            gameState.scenariosCompleted++;
            
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
            }
            
            // Save to localStorage
            localStorage.setItem('highScore', gameState.highScore);
            localStorage.setItem('scenariosCompleted', gameState.scenariosCompleted);
            localStorage.setItem('responseEffectiveness', gameState.responseEffectiveness);
            localStorage.setItem('decisionsMade', gameState.decisionsMade);
            
            // Display results
            addLog(`MISSION ${gameState.progress >= 100 ? 'ACCOMPLISHED' : 'TERMINATED'}! Final score: ${gameState.score}`, 'info');
            addLog(`Public trust: ${gameState.trust}%`, gameState.trust > 60 ? 'success' : 'warning');
            addLog(`Resources remaining: $${gameState.resources.toLocaleString()}`, 'info');
            addLog(`Response effectiveness: ${gameState.responseEffectiveness}%`, 'critical');
            
            updateStatistics();
        }
        
        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>