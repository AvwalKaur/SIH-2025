<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloodQuest 🌊</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --light-bg: #f5f7fb;

            --p1: #309ad4;
            --p2: #e69c42;
            --p3: #ea8d99;
            --p4: #faafa4;
            --p5: #e2afd3;
            --p6: #c8e5f3;
            --p7: #fae8c7;

            --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
            --transition: all 0.25s ease;
            --glass: rgba(255, 255, 255, 0.72);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Ubuntu", sans-serif;
        }
        
        body {
            background: var(--light-bg);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        .game-info {
            flex: 1;
            min-width: 340px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .game-area {
            flex: 2;
            min-width: 650px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--p1);
        }
        
        h1 {
            font-size: 2.8rem;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: none;
            font-weight: 700;
        }
        
        h2 {
            font-size: 1.8rem;
            color: var(--p2);
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        h3 {
            font-size: 1.4rem;
            color: var(--secondary);
            margin: 15px 0 10px;
            font-weight: 500;
        }
        
        .rules-list, .points-list {
            margin-left: 20px;
            margin-bottom: 20px;
        }
        
        li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .stats {
            background: linear-gradient(180deg, #fff, #fbfdff);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(26, 115, 232, 0.08);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: linear-gradient(180deg, #fff, #fbfdff);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(16, 24, 32, 0.03);
            box-shadow: var(--shadow);
        }
        
        .status-item {
            text-align: center;
            flex: 1;
            padding: 12px;
            margin: 0 5px;
            background: linear-gradient(180deg, var(--light-bg), #fff);
            border-radius: 8px;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .scenario {
            background: linear-gradient(180deg, #fff, #fbfdff);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            flex-grow: 1;
            border: 1px solid rgba(16, 24, 32, 0.03);
            box-shadow: var(--shadow);
        }
        
        .scenario-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            background: linear-gradient(180deg, var(--light-bg), #fff);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .scenario-icon {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--p1), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-right: 20px;
            color: white;
            box-shadow: 0 6px 18px rgba(48, 154, 212, 0.3);
        }
        
        .scenario-details {
            flex-grow: 1;
        }
        
        .scenario-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 20px;
            background: linear-gradient(180deg, var(--light-bg), #fff);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .city-map {
            height: 200px;
            background: linear-gradient(180deg, var(--light-bg), #fff);
            border-radius: 12px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .river {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30%;
            background: linear-gradient(90deg, var(--p1), var(--primary));
        }
        
        .neighborhood {
            position: absolute;
            width: 25%;
            height: 40%;
            background: linear-gradient(90deg, var(--secondary), #2ea044);
            border-radius: 8px;
        }
        
        .neighborhood-1 {
            bottom: 30%;
            left: 10%;
        }
        
        .neighborhood-2 {
            bottom: 30%;
            right: 10%;
        }
        
        .city-center {
            position: absolute;
            bottom: 30%;
            left: 40%;
            width: 20%;
            height: 50%;
            background: linear-gradient(90deg, var(--p3), var(--accent));
            border-radius: 8px;
        }
        
        .levee {
            position: absolute;
            bottom: 30%;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--p2), var(--warning));
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(26, 115, 232, 0.25);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .danger {
            background: linear-gradient(90deg, var(--p3), var(--accent));
        }
        
        .danger:hover {
            box-shadow: 0 12px 28px rgba(242, 92, 84, 0.25);
        }
        
        .success {
            background: linear-gradient(90deg, var(--secondary), #2ea044);
        }
        
        .success:hover {
            box-shadow: 0 12px 28px rgba(52, 168, 83, 0.25);
        }
        
        .warning {
            background: linear-gradient(90deg, var(--p2), var(--warning));
        }
        
        .warning:hover {
            box-shadow: 0 12px 28px rgba(230, 156, 66, 0.25);
        }
        
        .prevention {
            background: linear-gradient(90deg, var(--p5), #9b59b6);
        }
        
        .prevention:hover {
            box-shadow: 0 12px 28px rgba(226, 175, 211, 0.25);
        }
        
        .log {
            background: linear-gradient(180deg, #fff, #fbfdff);
            height: 180px;
            border-radius: 12px;
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 0.95rem;
            border: 1px solid rgba(16, 24, 32, 0.03);
            box-shadow: var(--shadow);
        }
        
        .log-entry {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(26, 115, 232, 0.08);
            line-height: 1.5;
        }
        
        .success-text {
            color: var(--secondary);
        }
        
        .danger-text {
            color: var(--accent);
        }
        
        .warning-text {
            color: var(--warning);
        }
        
        .info-text {
            color: var(--primary);
        }
        
        .prevention-text {
            color: var(--p5);
        }
        
        .restart-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, var(--secondary), #2ea044);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
            box-shadow: var(--shadow);
        }
        
        .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(52, 168, 83, 0.25);
        }
        
        .progress-container {
            height: 20px;
            background: linear-gradient(180deg, var(--light-bg), #fff);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--p1), var(--secondary));
            border-radius: 12px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .flood-level {
            height: 20px;
            background: linear-gradient(180deg, var(--light-bg), #fff);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }
        
        .flood-level-fill {
            height: 100%;
            background: linear-gradient(to right, var(--p1), var(--primary));
            border-radius: 12px;
            width: 30%;
            transition: width 0.5s ease;
        }
        
        .flood-level-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            text-shadow: none;
            color: var(--text-dark);
        }
        
        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
            }
            
            .game-info, .game-area {
                min-width: 100%;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .actions {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar styling */
        .log::-webkit-scrollbar {
            width: 8px;
        }

        .log::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, var(--p6), var(--p1));
            border-radius: 12px;
        }

        .log::-webkit-scrollbar-track {
            background: transparent;
        }

        /* Animation for highlight effects */
        @keyframes highlightPulse {
            0% {
                box-shadow: var(--shadow);
                transform: translateY(0);
            }
            50% {
                box-shadow: 0 12px 30px rgba(48, 154, 212, 0.15);
                transform: translateY(-2px);
            }
            100% {
                box-shadow: var(--shadow);
                transform: translateY(0);
            }
        }

        .highlight {
            animation: highlightPulse 1s ease-in-out;
        }

        /* Enhanced city map styling */
        .neighborhood, .city-center {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Tooltip styling */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-dark);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-info">
            <header>
                <h1>FloodQuest 🌊</h1>
                <p>Urban Flood Preparedness Education Game</p>
            </header>
            
            <h2>Game Rules</h2>
            <ul class="rules-list">
                <li>Anticipate, simulate, and respond to urban flooding scenarios</li>
                <li>Balance immediate response with long-term prevention</li>
                <li>Manage limited resources effectively</li>
                <li>Make decisions under time pressure</li>
                <li>Learn realistic flood preparedness strategies</li>
                <li>Each playthrough features different scenarios and challenges</li>
            </ul>
            
            <h2>Scoring System</h2>
            <ul class="points-list">
                <li>+100 points for preventing major flooding</li>
                <li>+75 points for effective evacuation plans</li>
                <li>+50 points for efficient resource allocation</li>
                <li>+60 points for infrastructure protection</li>
                <li>+40 points for timely warnings</li>
                <li>-30 points for each neighborhood flooded</li>
            </ul>
            
            <div class="stats">
                <h2>Your Statistics</h2>
                <div class="stat-item">
                    <span>Highest Score:</span>
                    <span id="high-score">0</span>
                </div>
                <div class="stat-item">
                    <span>Games Played:</span>
                    <span id="games-played">0</span>
                </div>
                <div class="stat-item">
                    <span>Neighborhoods Saved:</span>
                    <span id="neighborhoods-saved">0</span>
                </div>
                <div class="stat-item">
                    <span>Prevention Level:</span>
                    <span id="prevention-level">0%</span>
                </div>
            </div>
            
            <button class="restart-btn" onclick="initGame()">🌊 New Flood Scenario</button>
        </div>
        
        <div class="game-area">
            <div class="status-bar">
                <div class="status-item">
                    <div>Resources</div>
                    <div class="status-value" id="resources">$75,000</div>
                </div>
                <div class="status-item">
                    <div>Time</div>
                    <div class="status-value" id="time">08:00</div>
                </div>
                <div class="status-item">
                    <div>Safety Score</div>
                    <div class="status-value" id="safety">85%</div>
                </div>
                <div class="status-item">
                    <div>Total Score</div>
                    <div class="status-value" id="score">0</div>
                </div>
            </div>
            
            <div class="flood-level">
                <div class="flood-level-fill" id="flood-level"></div>
                <div class="flood-level-text" id="flood-level-text">Flood Level: 30%</div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="scenario">
                <div class="scenario-header">
                    <div class="scenario-icon">🌧️</div>
                    <div class="scenario-details">
                        <h3 id="scenario-name">River Flood Preparedness</h3>
                        <p id="scenario-difficulty">Risk Level: High</p>
                    </div>
                </div>
                
                <div class="city-map">
                    <div class="river"></div>
                    <div class="levee"></div>
                    <div class="neighborhood neighborhood-1">Homes</div>
                    <div class="neighborhood neighborhood-2">Businesses</div>
                    <div class="city-center">City Center</div>
                </div>
                
                <div class="scenario-text" id="scenario-text">
                    The river is rising after 3 days of heavy rainfall. Current level is 30% capacity and increasing. 
                    You need to protect 3 key areas: Residential neighborhood (5,000 people), Business district (200 businesses), 
                    and City Center (hospital, emergency services). Make decisions to prevent flooding and minimize damage.
                </div>
                
                <div class="actions">
                    <button class="prevention tooltip" onclick="makeDecision('reinforce')" data-tooltip="Costs $20,000 - High effectiveness">
                        🛡️ Reinforce Levees
                    </button>
                    <button class="warning tooltip" onclick="makeDecision('evacuate')" data-tooltip="Costs $10,000 - Saves lives">
                        🚨 Evacuate Areas
                    </button>
                    <button class="tooltip" onclick="makeDecision('drainage')" data-tooltip="Costs $15,000 - Improves water flow">
                        🔄 Improve Drainage
                    </button>
                    <button class="success tooltip" onclick="makeDecision('sandbags')" data-tooltip="Costs $8,000 - Quick protection">
                        🛍️ Deploy Sandbags
                    </button>
                </div>
            </div>
            
            <div class="log" id="log">
                <div class="log-entry info-text">🌊 Flood warning issued! River levels are rising rapidly.</div>
                <div class="log-entry warning-text">⚠️ 3 key areas at risk: Homes, Businesses, and City Center.</div>
                <div class="log-entry">💰 You have $75,000 and 8 minutes to prevent disaster.</div>
                <div class="log-entry prevention-text">💡 Tip: Use keyboard shortcuts 1-4 for quick actions!</div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            resources: 75000,
            time: 480, // 8 minutes in seconds
            safety: 85,
            score: 0,
            progress: 0,
            floodLevel: 30,
            gameOver: false,
            timer: null,
            scenario: null,
            neighborhoods: [true, true, true], // Homes, Businesses, City Center
            highScore: parseInt(localStorage.getItem('highScore')) || 0,
            gamesPlayed: parseInt(localStorage.getItem('gamesPlayed')) || 0,
            neighborhoodsSaved: parseInt(localStorage.getItem('neighborhoodsSaved')) || 0,
            preventionLevel: parseInt(localStorage.getItem('preventionLevel')) || 0
        };
        
        // Flood scenarios
        const scenarios = [
            {
                name: "River Flood Preparedness",
                icon: "🌧️",
                difficulty: "High",
                description: "The river is rising after 3 days of heavy rainfall. Current level is 30% capacity and increasing. You need to protect 3 key areas: Residential neighborhood (5,000 people), Business district (200 businesses), and City Center (hospital, emergency services). Make decisions to prevent flooding and minimize damage.",
                resources: 75000,
                time: 480,
                floodLevel: 30,
                floodRate: 0.5 // % per second
            },
            {
                name: "Flash Flood Emergency",
                icon: "⚡",
                difficulty: "Very High",
                description: "A sudden thunderstorm has dumped 4 inches of rain in 2 hours. Flash flooding is imminent in low-lying urban areas. The drainage system is overwhelmed. You must act quickly to protect vulnerable areas and prevent casualties.",
                resources: 60000,
                time: 360,
                floodLevel: 40,
                floodRate: 0.8 // % per second
            },
            {
                name: "Coastal Flooding",
                icon: "🌊",
                difficulty: "Extreme",
                description: "A combination of high tides and storm surge is threatening coastal urban areas. Sea walls may be overtopped. You need to protect critical infrastructure and plan for potential evacuation of low-lying neighborhoods.",
                resources: 90000,
                time: 600,
                floodLevel: 25,
                floodRate: 0.4 // % per second
            },
            {
                name: "Urban Drainage Failure",
                icon: "🏙️",
                difficulty: "Moderate",
                description: "The city's aging drainage system has failed during heavy rainfall. Water is accumulating in streets and basements. You need to manage pumping operations and protect electrical infrastructure while planning repairs.",
                resources: 50000,
                time: 420,
                floodLevel: 35,
                floodRate: 0.6 // % per second
            },
            {
                name: "Dam Release Warning",
                icon: "🚧",
                difficulty: "High",
                description: "Upstream dam must release water due to structural concerns. Downstream urban areas will experience rapid water level rises. You have limited time to warn residents and protect property.",
                resources: 80000,
                time: 300,
                floodLevel: 20,
                floodRate: 1.0 // % per second
            }
        ];
        
        // Enhanced visual feedback functions
        function addButtonClickEffect(button) {
            button.style.transform = 'scale(0.95)';
            button.style.boxShadow = '0 4px 12px rgba(26, 115, 232, 0.4)';
            setTimeout(() => {
                button.style.transform = '';
                button.style.boxShadow = '';
            }, 150);
        }
        
        function showInsufficientFundsEffect(button) {
            const originalBg = button.style.background;
            button.style.background = 'linear-gradient(90deg, var(--accent), #d32f2f)';
            button.style.transform = 'scale(0.98) translateX(-2px)';
            setTimeout(() => {
                button.style.background = originalBg;
                button.style.transform = '';
            }, 300);
        }
        
        function animateValue(elementId, startValue, endValue) {
            const element = document.getElementById(elementId);
            const duration = 800;
            const startTime = performance.now();
            
            function updateValue(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentValue = Math.round(startValue + (endValue - startValue) * progress);
                
                if (elementId === 'resources') {
                    element.textContent = `$${currentValue.toLocaleString()}`;
                } else if (elementId === 'safety') {
                    element.textContent = `${currentValue}%`;
                } else {
                    element.textContent = currentValue;
                }
                
                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                } else {
                    element.classList.add('highlight');
                    setTimeout(() => element.classList.remove('highlight'), 600);
                }
            }
            
            requestAnimationFrame(updateValue);
        }
        
        // Initialize the game with enhanced features
        function initGame() {
            // Clear previous timer
            clearInterval(gameState.timer);
            
            // Select random scenario
            gameState.scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            
            // Reset game state
            gameState.resources = gameState.scenario.resources;
            gameState.time = gameState.scenario.time;
            gameState.safety = 85;
            gameState.score = 0;
            gameState.progress = 0;
            gameState.floodLevel = gameState.scenario.floodLevel;
            gameState.gameOver = false;
            gameState.neighborhoods = [true, true, true];
            
            // Update scenario display
            document.getElementById('scenario-name').textContent = gameState.scenario.name;
            document.getElementById('scenario-difficulty').textContent = `Risk Level: ${gameState.scenario.difficulty}`;
            document.getElementById('scenario-text').textContent = gameState.scenario.description;
            
            // Clear log and add initial messages with enhanced formatting
            const log = document.getElementById('log');
            log.innerHTML = '';
            addLog(`Flood warning: ${gameState.scenario.name}`, 'info');
            addLog(`Risk Level: ${gameState.scenario.difficulty}`, 'warning');
            addLog(gameState.scenario.description, 'info');
            addLog("Make strategic decisions to prevent flooding and protect urban areas.", 'prevention');
            addLog("Keyboard shortcuts: 1-Reinforce, 2-Evacuate, 3-Drainage, 4-Sandbags", 'info');
            
            // Update display
            updateDisplay();
            
            // Update statistics
            updateStatistics();
            
            // Start timer
            startTimer();
        }
        
        // Add keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (gameState.gameOver) return;
            
            switch(event.key) {
                case '1':
                    makeDecision('reinforce');
                    break;
                case '2':
                    makeDecision('evacuate');
                    break;
                case '3':
                    makeDecision('drainage');
                    break;
                case '4':
                    makeDecision('sandbags');
                    break;
                case 'r':
                case 'R':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        initGame();
                    }
                    break;
                case ' ':
                    event.preventDefault();
                    // Pause/unpause functionality
                    if (gameState.timer) {
                        clearInterval(gameState.timer);
                        gameState.timer = null;
                        addLog("Game paused. Press space to resume.", 'info');
                    } else if (!gameState.gameOver) {
                        startTimer();
                        addLog("Game resumed.", 'info');
                    }
                    break;
            }
        });
        
        // Update the game display
        function updateDisplay() {
            document.getElementById('resources').textContent = `$${gameState.resources.toLocaleString()}`;
            
            const minutes = Math.floor(gameState.time / 60);
            const seconds = gameState.time % 60;
            document.getElementById('time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('safety').textContent = `${gameState.safety}%`;
            document.getElementById('score').textContent = gameState.score;
            
            document.getElementById('flood-level').style.width = `${gameState.floodLevel}%`;
            document.getElementById('flood-level-text').textContent = `Flood Level: ${Math.round(gameState.floodLevel)}%`;
            
            document.getElementById('progress-bar').style.width = `${gameState.progress}%`;
            
            // Update neighborhood colors based on flood risk
            updateNeighborhoods();
        }
        
        // Update neighborhood appearances based on flood risk
        function updateNeighborhoods() {
            const riskLevel = gameState.floodLevel / 100;
            const homes = document.querySelector('.neighborhood-1');
            const businesses = document.querySelector('.neighborhood-2');
            const cityCenter = document.querySelector('.city-center');
            
            if (gameState.floodLevel > 70) {
                homes.style.background = '#e74c3c';
                businesses.style.background = '#e74c3c';
                cityCenter.style.background = '#e74c3c';
            } else if (gameState.floodLevel > 40) {
                homes.style.background = '#f39c12';
                businesses.style.background = '#f39c12';
                cityCenter.style.background = '#e74c3c';
            } else {
                homes.style.background = '#2ecc71';
                businesses.style.background = '#2ecc71';
                cityCenter.style.background = '#e74c3c';
            }
        }
        
        // Update statistics panel
        function updateStatistics() {
            document.getElementById('high-score').textContent = gameState.highScore;
            document.getElementById('games-played').textContent = gameState.gamesPlayed;
            document.getElementById('neighborhoods-saved').textContent = gameState.neighborhoodsSaved;
            document.getElementById('prevention-level').textContent = `${gameState.preventionLevel}%`;
        }
        
        // Start the countdown timer
        function startTimer() {
            gameState.timer = setInterval(() => {
                if (gameState.gameOver) {
                    clearInterval(gameState.timer);
                    return;
                }
                
                gameState.time--;
                gameState.floodLevel += gameState.scenario.floodRate;
                
                if (gameState.time <= 0 || gameState.floodLevel >= 100) {
                    endGame();
                    return;
                }
                
                // Random event chance
                if (Math.random() > 0.95) {
                    const events = [
                        {msg: 'Additional rainfall reported! Flood risk increasing.', floodLevel: +10, type: 'danger'},
                        {msg: 'Federal emergency funds allocated!', resources: +15000, type: 'success'},
                        {msg: 'Drainage system partially clogged!', floodLevel: +5, type: 'warning'},
                        {msg: 'Community volunteers assisting with preparations!', safety: +5, type: 'info'},
                        {msg: 'Unexpected levee weakness detected!', floodLevel: +8, type: 'prevention'}
                    ];
                    
                    const event = events[Math.floor(Math.random() * events.length)];
                    addLog(event.msg, event.type);
                    
                    if (event.resources) gameState.resources += event.resources;
                    if (event.floodLevel) gameState.floodLevel += event.floodLevel;
                    if (event.safety) gameState.safety += event.safety;
                }
                
                updateDisplay();
            }, 1000);
        }
        
        // Add a message to the log with enhanced visual feedback
        function addLog(message, type = 'info') {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}-text`;
            
            // Add icons based on message type
            const icons = {
                'success': '✅',
                'danger': '❌',
                'warning': '⚠️',
                'info': 'ℹ️',
                'prevention': '🛡️'
            };
            
            const icon = icons[type] || '•';
            entry.textContent = `${icon} ${message}`;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            
            // Add highlight animation to new entries
            entry.style.opacity = '0';
            entry.style.transform = 'translateX(-10px)';
            setTimeout(() => {
                entry.style.transition = 'all 0.3s ease';
                entry.style.opacity = '1';
                entry.style.transform = 'translateX(0)';
            }, 100);
        }
        
        // Process player decisions with enhanced feedback
        function makeDecision(decision) {
            if (gameState.gameOver) return;
            
            let resourceChange = 0;
            let floodChange = 0;
            let safetyChange = 0;
            let progressChange = 0;
            let scoreChange = 0;
            let message = '';
            
            switch(decision) {
                case 'reinforce':
                    if (gameState.resources >= 20000) {
                        resourceChange = -20000;
                        floodChange = -15;
                        safetyChange = 10;
                        progressChange = 20;
                        scoreChange = 80;
                        message = 'Levees reinforced. Flood protection significantly improved.';
                        addButtonClickEffect(event.target);
                    } else {
                        safetyChange = -5;
                        message = 'Insufficient resources for levee reinforcement. Seek additional funding.';
                        showInsufficientFundsEffect(event.target);
                    }
                    break;
                    
                case 'evacuate':
                    if (gameState.resources >= 10000) {
                        resourceChange = -10000;
                        floodChange = -5;
                        safetyChange = 15;
                        progressChange = 15;
                        scoreChange = 70;
                        message = 'Evacuation plans implemented. Residents moving to safety.';
                        addButtonClickEffect(event.target);
                    } else {
                        safetyChange = -8;
                        message = 'Limited resources for evacuation efforts. Some areas at risk.';
                        showInsufficientFundsEffect(event.target);
                    }
                    break;
                    
                case 'drainage':
                    if (gameState.resources >= 15000) {
                        resourceChange = -15000;
                        floodChange = -10;
                        safetyChange = 5;
                        progressChange = 18;
                        scoreChange = 60;
                        message = 'Drainage systems improved. Water diversion effective.';
                        addButtonClickEffect(event.target);
                    } else {
                        floodChange = 5;
                        message = 'Drainage improvements delayed due to budget constraints.';
                        showInsufficientFundsEffect(event.target);
                    }
                    break;
                    
                case 'sandbags':
                    if (gameState.resources >= 8000) {
                        resourceChange = -8000;
                        floodChange = -8;
                        safetyChange = 8;
                        progressChange = 12;
                        scoreChange = 50;
                        message = 'Sandbag barriers deployed. Immediate protection established.';
                        addButtonClickEffect(event.target);
                    } else {
                        floodChange = 3;
                        message = 'Insufficient sandbags for all vulnerable areas. Prioritization needed.';
                        showInsufficientFundsEffect(event.target);
                    }
                    break;
            }
            
            // Apply changes with animation
            const oldResources = gameState.resources;
            const oldSafety = gameState.safety;
            const oldScore = gameState.score;
            
            gameState.resources = Math.max(0, gameState.resources + resourceChange);
            gameState.floodLevel = Math.min(100, Math.max(0, gameState.floodLevel + floodChange));
            gameState.safety = Math.min(100, Math.max(0, gameState.safety + safetyChange));
            gameState.progress = Math.min(100, gameState.progress + progressChange);
            gameState.score += scoreChange;
            
            // Animate value changes
            if (resourceChange !== 0) animateValue('resources', oldResources, gameState.resources);
            if (safetyChange !== 0) animateValue('safety', oldSafety, gameState.safety);
            if (scoreChange !== 0) animateValue('score', oldScore, gameState.score);
            
            // Add log message
            addLog(message, floodChange < 0 ? 'success' : 'warning');
            
            // Check for game completion
            if (gameState.progress >= 100) {
                addLog('Flood prevention measures completed successfully!', 'success');
                endGame();
            }
            
            updateDisplay();
        }
        
        // End the game
        function endGame() {
            gameState.gameOver = true;
            clearInterval(gameState.timer);
            
            // Calculate final score
            const safetyBonus = gameState.safety * 2;
            const resourceBonus = gameState.resources / 100;
            const floodPenalty = gameState.floodLevel * 10;
            
            gameState.score += safetyBonus + resourceBonus - floodPenalty;
            
            // Calculate neighborhoods saved
            const saved = gameState.floodLevel < 70 ? 3 : gameState.floodLevel < 85 ? 2 : 1;
            gameState.neighborhoodsSaved += saved;
            
            // Calculate prevention level
            gameState.preventionLevel = Math.max(0, 100 - gameState.floodLevel);
            
            // Update statistics
            gameState.gamesPlayed++;
            
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
            }
            
            // Save to localStorage
            localStorage.setItem('highScore', gameState.highScore);
            localStorage.setItem('gamesPlayed', gameState.gamesPlayed);
            localStorage.setItem('neighborhoodsSaved', gameState.neighborhoodsSaved);
            localStorage.setItem('preventionLevel', gameState.preventionLevel);
            
            // Display results
            addLog(`FLOOD ${gameState.floodLevel < 70 ? 'PREVENTED' : 'OCCURRED'}! Final score: ${gameState.score}`, 'info');
            addLog(`Final flood level: ${Math.round(gameState.floodLevel)}%`, gameState.floodLevel < 70 ? 'success' : 'danger');
            addLog(`Neighborhoods saved: ${saved}/3`, saved > 2 ? 'success' : 'warning');
            addLog(`Resources remaining: $${gameState.resources.toLocaleString()}`, 'info');
            
            updateStatistics();
        }
        
        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>