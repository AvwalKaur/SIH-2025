<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamified Learning - DisasterSafe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --light-bg: #f5f7fb;

            --p1: #309ad4;
            --p2: #e69c42;
            --p3: #ea8d99;
            --p4: #faafa4;
            --p5: #e2afd3;
            --p6: #c8e5f3;
            --p7: #fae8c7;

            --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
            --transition: all 0.25s ease;
            --glass: rgba(255, 255, 255, 0.72);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--light-bg);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: "Ubuntu", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        /* Layout */
        .dashboard-container {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: #fff;
            padding: 22px;
            position: fixed;
            width: 240px;
            height: 100%;
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 200;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06)
        }

        .logo i {
            font-size: 22px;
            color: var(--p6)
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.2px
        }

        .menu-items {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.95);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }

        .new-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #fff;
            margin-left: auto;
        }

        /* Dropdown Menu Styles - VERTICAL LAYOUT */
        .dropdown-menu {
            position: relative;
            z-index: 10;
            width: 100%;
            display: flex;
            flex-direction: column;
            margin-bottom: 4px;
        }

        .menu-item-main {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.95);
        }

        .menu-item-main i:first-child {
            width: 20px;
            text-align: center;
        }

        .dropdown-arrow {
            margin-left: auto;
            transition: transform 0.3s ease;
            font-size: 12px;
        }

        .dropdown-menu.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .menu-item-main:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .dropdown-menu.active .menu-item-main {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }

        .dropdown-content {
            display: none;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            margin: 4px 0 8px 0;
            padding: 4px 0;
            width: 100%;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .dropdown-menu.active .dropdown-content {
            display: block !important;
            animation: slideDown 0.3s ease-out forwards;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                max-height: 200px;
                transform: translateY(0);
            }
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            margin: 2px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.85);
            font-size: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item i {
            width: 16px;
            text-align: center;
            font-size: 12px;
            color: #4ecdc4;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.12);
            color: rgba(255, 255, 255, 1);
            transform: translateX(4px);
        }

        .dropdown-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .menu-item i {
            width: 20px;
            text-align: center
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.06)
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08)
        }

        /* Sidebar User Profile */
        .sidebar-user-profile {
            margin-top: auto;
            padding: 12px;
            margin: 0 -12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            cursor: pointer;
        }

        .sidebar-user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--p6), var(--p1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-dark);
            text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-info p {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }

        /* Main content */
        .main-content {
            grid-column: 2;
            padding: 20px;
            min-height: 100vh
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-dark);
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .header-section h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header-section p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        /* Search Bar */
        .search-container {
            margin: 30px 0;
            display: flex;
            justify-content: center;
        }

        .search-bar {
            display: flex;
            width: 100%;
            max-width: 600px;
            background: var(--card-bg);
            border-radius: 50px;
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .search-bar:focus-within {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(26, 115, 232, 0.2);
        }

        .search-bar input {
            flex: 1;
            padding: 15px 25px;
            border: none;
            outline: none;
            font-size: 1rem;
            background: transparent;
            color: var(--text-dark);
        }

        .search-bar button {
            padding: 15px 25px;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .search-bar button:hover {
            background: var(--primary-dark);
        }

        /* Game Filter Bar */
        .game-filter-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .filter-option {
            padding: 12px 24px;
            border: 2px solid transparent;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .filter-option:hover {
            background: rgba(26, 115, 232, 0.1);
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .filter-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        .filter-option i {
            font-size: 16px;
        }

        /* Responsive filter bar */
        @media (max-width: 768px) {
            .game-filter-bar {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                padding: 15px;
            }

            .filter-option {
                padding: 10px 18px;
                font-size: 13px;
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .game-card {
            background: var(--card-bg);
            border-radius: 14px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            border: 1px solid rgba(16, 24, 32, 0.03);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .game-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .game-header {
            height: 160px;
            position: relative;
            background: linear-gradient(90deg, var(--p6), var(--p1));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }

        .game-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            z-index: 2;
        }

        .game-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(90deg, var(--p3), var(--accent));
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }

        .game-content {
            padding: 24px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .game-content h3 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .game-content p {
            color: #6c757d;
            margin-bottom: 18px;
            line-height: 1.6;
            flex: 1;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
            padding: 15px;
            background: rgba(26, 115, 232, 0.05);
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .game-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 18px;
        }

        .feature-tag {
            padding: 5px 10px;
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary);
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .game-actions {
            display: flex;
            gap: 12px;
            margin-top: auto;
        }

        .btn-primary {
            flex: 1;
            padding: 12px 18px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(26, 115, 232, 0.3);
        }

        .btn-secondary {
            padding: 12px 18px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Disaster Info Modal */
        .disaster-info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .disaster-info-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .disaster-modal-content {
            background: white;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: slideInUp 0.4s ease;
        }

        .disaster-modal-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 15px 15px 0 0;
            position: relative;
        }

        .disaster-modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: var(--transition);
        }

        .disaster-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .disaster-modal-title {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .disaster-modal-subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .disaster-modal-body {
            padding: 30px;
        }

        .disaster-section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 4px solid var(--primary);
            animation: fadeIn 0.5s ease;
        }

        .disaster-section h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        .disaster-section ul {
            list-style: none;
            padding: 0;
        }

        .disaster-section li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .disaster-section li:last-child {
            border-bottom: none;
        }

        .disaster-section li i {
            color: var(--secondary);
            margin-top: 4px;
            flex-shrink: 0;
        }

        .disaster-animation {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 10px;
            border: 2px dashed var(--primary);
        }

        .animation-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .dashboard-container {
                grid-template-columns: 1fr
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto
            }

            .main-content {
                padding: 18px
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .game-actions {
                flex-direction: column;
            }

            .disaster-modal-content {
                width: 95%;
                margin: 10px;
            }
        }

        /* No results message */
        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }

        .no-results i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }

        /* Assessment Dashboard Styles */
        .assessment-dashboard {
            margin: 20px 0;
            min-height: 60px;
        }

        .assessment-notification {
            background: linear-gradient(135deg, var(--secondary), #2e7d32);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid #4caf50;
            animation: slideInDown 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .assessment-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.1) 50%, transparent 60%);
            animation: shimmer 2s infinite;
        }

        .assessment-notification.improvement {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-left-color: var(--primary);
        }

        .assessment-notification.warning {
            background: linear-gradient(135deg, var(--warning), #f57c00);
            border-left-color: var(--warning);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .notification-header i {
            font-size: 1.3rem;
        }

        .notification-content {
            font-size: 0.95rem;
            line-height: 1.5;
            opacity: 0.95;
        }

        /* Performance Summary Styles */
        .performance-summary {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .performance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .performance-header h2 {
            color: var(--text-dark);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .overall-rating {
            text-align: center;
        }

        .rating-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            box-shadow: 0 4px 20px rgba(26, 115, 232, 0.3);
        }

        .rating-score {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
        }

        .rating-max {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .rating-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .performance-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-item {
            background: rgba(26, 115, 232, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(26, 115, 232, 0.1);
            transition: var(--transition);
        }

        .category-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(26, 115, 232, 0.15);
        }

        .category-item i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .category-name {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .category-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .progress-text {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
            min-width: 35px;
        }

        .performance-insights {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .performance-insights h3 {
            color: var(--text-dark);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .insights-content {
            line-height: 1.6;
            color: #555;
        }

        .insights-list {
            list-style: none;
            padding: 0;
        }

        .insights-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .insights-list li:last-child {
            border-bottom: none;
        }

        .insights-list li i {
            color: var(--secondary);
            margin-top: 2px;
            flex-shrink: 0;
        }

        .insights-list li.warning i {
            color: var(--warning);
        }

        .insights-list li.improvement i {
            color: var(--primary);
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        /* Responsive adjustments for assessment features */
        @media (max-width: 768px) {
            .performance-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .performance-categories {
                grid-template-columns: 1fr;
            }

            .rating-circle {
                width: 70px;
                height: 70px;
            }

            .rating-score {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>JeevanSetu</h1>
            </div>
            <div class="menu-items">
                <div class="menu-item" data-link="dashboard-student.html"><i class="fas fa-home"></i><span>Dashboard</span></div>
                <div class="menu-item dropdown-menu" id="educationDropdown">
                    <div class="menu-item-main">
                        <i class="fas fa-book"></i><span>Education Modules</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </div>
                    <div class="dropdown-content">
                        <div class="dropdown-item" data-link="education-modules.html"><i class="fas fa-graduation-cap"></i><span>Learning Modules</span></div>
                        <div class="dropdown-item" data-link="../dos&donts.html"><i class="fas fa-exclamation-triangle"></i><span>Dos & Don'ts</span></div>
                    </div>
                </div>
                <div class="menu-item" data-link="sandbox-simulator.html"><i class="fas fa-gamepad"></i><span>Sandbox Simulator</span></div>
                <div class="menu-item" data-link="../emergency_contacts.html"><i class="fas fa-phone-alt"></i><span>Emergency Contacts</span></div>
                <div class="menu-item" data-link="../drill_schedule.html"><i class="fa-solid fa-calendar-days"></i><span>Drill Schedule</span></div>
                <div class="menu-item" data-link="../advanced-map.html"><i class="fas fa-map-marked-alt"></i><span>Disaster Map</span></div>
                <div class="menu-item" data-link="chatbot.html"><i class="fas fa-robot"></i><span>AI Helper</span></div>
                <div class="menu-item active" data-link="gamified-learning.html"><i class="fas fa-graduation-cap"></i><span>Gamified Learning</span></div>
                <!-- <div class="menu-item"><i class="fas fa-user"></i><span>Profile & Badges</span></div> -->
                <div class="menu-item" data-link="settings.html"><i class="fas fa-cog"></i><span>Settings</span></div>
            </div>

            <!-- User Profile at Bottom -->
            <div class="sidebar-user-profile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h4 id="sidebarUserName">User</h4>
                    <p>Student</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <div class="header-section">
                    <h1>Gamified Disaster Learning</h1>
                    <p>Learn disaster management through engaging games and challenges</p>
                </div>

                <!-- Player Assessment Dashboard -->
                <div class="assessment-dashboard" id="assessmentDashboard">
                    <!-- Assessment notification will be added here dynamically -->
                </div>

                <!-- Player Performance Summary -->
                <div class="performance-summary" id="performanceSummary">
                    <div class="performance-header">
                        <h2>Your Disaster Preparedness Profile</h2>
                        <div class="overall-rating" id="overallRating">
                            <div class="rating-circle">
                                <span class="rating-score" id="ratingScore">0</span>
                                <span class="rating-max">/10</span>
                            </div>
                            <div class="rating-label" id="ratingLabel">Getting Started</div>
                        </div>
                    </div>

                    <div class="performance-categories">
                        <div class="category-item">
                            <i class="fas fa-earthquake"></i>
                            <span class="category-name">Natural Disasters</span>
                            <div class="category-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="naturalDisasterProgress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="naturalDisasterText">0%</span>
                            </div>
                        </div>

                        <div class="category-item">
                            <i class="fas fa-users"></i>
                            <span class="category-name">Emergency Response</span>
                            <div class="category-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="responseProgress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="responseText">0%</span>
                            </div>
                        </div>

                        <div class="category-item">
                            <i class="fas fa-toolbox"></i>
                            <span class="category-name">Preparedness</span>
                            <div class="category-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="preparednessProgress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="preparednessText">0%</span>
                            </div>
                        </div>

                        <div class="category-item">
                            <i class="fas fa-brain"></i>
                            <span class="category-name">Decision Making</span>
                            <div class="category-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="decisionProgress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="decisionText">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="performance-insights" id="performanceInsights">
                        <h3>Your Strengths & Areas for Improvement</h3>
                        <div class="insights-content" id="insightsContent">
                            <p>Play games to receive personalized insights about your disaster preparedness skills!</p>
                        </div>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="search-container">
                    <div class="search-bar">
                        <input type="text" id="gameSearch" placeholder="Search games by name, type, or disaster...">
                        <button><i class="fas fa-search"></i></button>
                    </div>
                </div>

                <!-- Game Filter Bar -->
                <div class="game-filter-bar">
                    <div class="filter-option active" data-filter="all">
                        <i class="fas fa-th-large"></i>
                        All Games
                    </div>
                    <div class="filter-option" data-filter="strategy">
                        <i class="fas fa-chess"></i>
                        Strategy
                    </div>
                    <div class="filter-option" data-filter="quiz">
                        <i class="fas fa-question-circle"></i>
                        Quiz
                    </div>
                    <div class="filter-option" data-filter="simulation">
                        <i class="fas fa-desktop"></i>
                        Simulation
                    </div>
                    <div class="filter-option" data-filter="multiplayer">
                        <i class="fas fa-users"></i>
                        Multiplayer
                    </div>
                    <!-- Demo Test Button -->
                    <div class="filter-option" onclick="quickTestAssessment()"
                        style="background: var(--accent); color: white; cursor: pointer;">
                        <i class="fas fa-vial"></i>
                        Test Assessment
                    </div>
                </div>

                <!-- Games Grid -->
                <div class="games-grid" id="gamesGrid">
                    <!-- Game cards will be populated by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <!-- Disaster Info Modal -->
    <div class="disaster-info-modal" id="disasterInfoModal">
        <div class="disaster-modal-content">
            <div class="disaster-modal-header">
                <button class="disaster-modal-close" id="closeDisasterModal">&times;</button>
                <h2 class="disaster-modal-title" id="disasterModalTitle">Disaster Information</h2>
                <p class="disaster-modal-subtitle" id="disasterModalSubtitle">Learn how to prepare and respond</p>
            </div>
            <div class="disaster-modal-body" id="disasterModalBody">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Menu Navigation
        document.addEventListener('DOMContentLoaded', function () {
            // Sidebar navigation
            const menuItems = document.querySelectorAll('.menu-item');
            const educationDropdown = document.getElementById('educationDropdown');

            menuItems.forEach(item => {
                // Exclude dropdown main button from this generic navigation
                if (item.id !== 'educationDropdown' && !item.classList.contains('dropdown-item')) {
                    item.addEventListener('click', function (event) {
                        const link = this.getAttribute('data-link');
                        if (link) {
                            window.location.href = link;
                        }
                    });
                }
            });

            // Dropdown menu functionality
            if (educationDropdown) {
                console.log('Education dropdown found, setting up event listeners');
                const mainDropdownButton = educationDropdown.querySelector('.menu-item-main');
                const dropdownContent = educationDropdown.querySelector('.dropdown-content');
                
                if (mainDropdownButton && dropdownContent) {
                    console.log('Dropdown button and content found');
                    mainDropdownButton.addEventListener('click', (event) => {
                        event.preventDefault();
                        event.stopPropagation();
                        console.log('Dropdown clicked, current active state:', educationDropdown.classList.contains('active'));
                        
                        // Close any other open dropdowns first (if there are multiple)
                        document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
                            if (dropdown !== educationDropdown) {
                                dropdown.classList.remove('active');
                            }
                        });
                        
                        // Toggle this dropdown
                        educationDropdown.classList.toggle('active');
                        console.log('After toggle, active state:', educationDropdown.classList.contains('active'));
                        
                        // Force display check
                        const isActive = educationDropdown.classList.contains('active');
                        console.log('Dropdown content display should be:', isActive ? 'block' : 'none');
                    });
                } else {
                    console.error('Dropdown button or content not found');
                }
            } else {
                console.error('Education dropdown not found');
            }

            // Handle navigation for dropdown items
            const dropdownItems = document.querySelectorAll('.dropdown-item');
            console.log('Found dropdown items:', dropdownItems.length);
            
            dropdownItems.forEach((item, index) => {
                const link = item.getAttribute('data-link');
                const text = item.querySelector('span')?.textContent.trim();
                console.log(`Dropdown item ${index}:`, text, 'Link:', link);
                
                item.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.stopPropagation(); // Stop event from bubbling up to the parent
                    
                    console.log('Dropdown item clicked:', text, 'Link:', link);
                    
                    if (link) {
                        // Close the dropdown
                        if (educationDropdown) {
                            educationDropdown.classList.remove('active');
                        }
                        
                        // Remove active class from all menu items and dropdown items
                        document.querySelectorAll('.menu-item, .dropdown-item').forEach(menuItem => {
                            menuItem.classList.remove('active');
                        });
                        
                        // Add active class to clicked dropdown item
                        item.classList.add('active');
                        
                        // Navigate to the page
                        console.log('Navigating to:', link);
                        window.location.href = link;
                    } else {
                        console.error('No link found for dropdown item:', text);
                    }
                });
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                if (educationDropdown && !educationDropdown.contains(event.target)) {
                    educationDropdown.classList.remove('active');
                }
            });
        });

        // Game data
        const gamesData = [
            {
                id: 'simcity-disaster',
                title: 'SimCity: Disaster Manager',
                description: 'Build resilient cities and manage disasters. Design emergency services, create evacuation routes, and rebuild after disasters.',
                icon: 'fas fa-city',
                badge: 'Strategy',
                players: '1',
                duration: '45-90',
                rating: '★ 4.9',
                features: ['City Building', 'Strategy', 'Resource Management', 'Planning'],
                disasterType: 'Multiple',
                category: 'strategy'
            },
            {
                id: 'tsunamiescape',
                title: 'Tsunami Escape',
                description: 'Fast-paced survival game. Solve puzzles and navigate to high ground before the tsunami hits. Learn warning signs and escape routes.',
                icon: 'fas fa-water',
                badge: 'Survival',
                players: '1',
                duration: '10-20',
                rating: '★ 4.6',
                features: ['Puzzle', 'Survival', 'Time Pressure', 'Education'],
                disasterType: 'Tsunami',
                category: 'simulation'
            },
            {
                id: 'hurricanehero',
                title: 'Hurricane Hero: Resource Dash',
                description: 'Prepare your community for an approaching hurricane. Secure homes, stock supplies, and make critical resource decisions.',
                icon: 'fas fa-wind',
                badge: 'Strategy',
                players: '1-3',
                duration: '25-40',
                rating: '★ 4.5',
                features: ['Strategy', 'Resource Management', 'Community', 'Preparation'],
                disasterType: 'Hurricane',
                category: 'strategy'
            },
            {
                id: 'wildfirewatch',
                title: 'Wildfire Watch',
                description: 'Act as wildfire incident commander. Manage firefighting teams, assess terrain, and adapt to changing conditions.',
                icon: 'fas fa-fire',
                badge: 'Strategy',
                players: '1',
                duration: '30-60',
                rating: '★ 4.7',
                features: ['Strategy', 'Real-time', 'Resource Management', 'Adaptation'],
                disasterType: 'Wildfire',
                category: 'strategy'
            },
            {
                id: 'quakeresponse',
                title: 'Quake Response',
                description: 'Search and rescue simulation after earthquakes. Remove rubble, assess structural integrity, and provide first aid.',
                icon: 'fas fa-house-damage',
                badge: 'Simulation',
                players: '1-2',
                duration: '20-35',
                rating: '★ 4.8',
                features: ['Simulation', 'Rescue', 'Decision Making', 'First Aid'],
                disasterType: 'Earthquake',
                category: 'simulation'
            },
            {
                id: 'floodplainproject',
                title: 'The Floodplain Project',
                description: 'Collaborative community flood mitigation. Engineers design defenses while leaders organize emergency responses.',
                icon: 'fas fa-house-flood-water',
                badge: 'Multiplayer',
                players: '3-6',
                duration: '60-90',
                rating: '★ 4.9',
                features: ['Collaboration', 'Planning', 'Sustainability', 'Community'],
                disasterType: 'Flood',
                category: 'multiplayer'
            },
            {
                id: 'stopdisasters',
                title: 'Stop Disasters!',
                description: 'UNDRR official game. Act as disaster risk manager, build safer communities under time and resource constraints.',
                icon: 'fas fa-shield-alt',
                badge: 'Official',
                players: '1',
                duration: '30-45',
                rating: '★ 4.8',
                features: ['Risk Management', 'Community Building', 'Time Pressure', 'Resource Planning'],
                disasterType: 'Multiple',
                category: 'strategy'
            },
            {
                id: 'disasterresponse',
                title: 'Disaster Response Game',
                description: 'Digital scenario game for rapid crisis response. Make quick decisions with limited information during emergencies.',
                icon: 'fas fa-ambulance',
                badge: 'Crisis',
                players: '1-4',
                duration: '20-30',
                rating: '★ 4.6',
                features: ['Quick Decisions', 'Crisis Management', 'Limited Information', 'Realistic'],
                disasterType: 'Multiple',
                category: 'simulation'
            },
            {
                id: 'roadtosafety',
                title: 'Road to Safety',
                description: 'Tabletop simulation with diverse avatars. Navigate disaster scenarios and understand how circumstances affect preparedness.',
                icon: 'fas fa-road',
                badge: 'Empathy',
                players: '2-6',
                duration: '40-60',
                rating: '★ 4.7',
                features: ['Role Playing', 'Empathy Building', 'Problem Solving', 'Awareness'],
                disasterType: 'Multiple',
                category: 'multiplayer'
            },
            {
                id: 'disastermind',
                title: 'Disaster Mind',
                description: 'FEMA-supported simulation promoting critical thinking and preparedness through immersive disaster scenarios.',
                icon: 'fas fa-brain',
                badge: 'FEMA',
                players: '1',
                duration: '30-50',
                rating: '★ 4.8',
                features: ['Critical Thinking', 'FEMA Support', 'Immersive', 'Educational'],
                disasterType: 'Multiple',
                category: 'simulation'
            },
            {
                id: 'floodquest',
                title: 'FloodQuest',
                description: 'Urban flood preparedness education. Anticipate, simulate, and respond to flooding scenarios with planning focus.',
                icon: 'fas fa-house-flood-water',
                badge: 'Urban',
                players: '1-2',
                duration: '25-40',
                rating: '★ 4.5',
                features: ['Urban Planning', 'Flood Response', 'Simulation', 'Preparedness'],
                disasterType: 'Flood',
                category: 'simulation'
            },
            {
                id: 'disasterquest',
                title: 'Disaster Quest',
                description: 'Escape room challenge with disaster scenarios. Solve puzzles to evacuate safely from earthquakes, floods, and fires.',
                icon: 'fas fa-puzzle-piece',
                badge: 'Puzzle',
                players: '1-4',
                duration: '15-30',
                rating: '★ 4.6',
                features: ['Escape Room', 'Puzzle Solving', 'Time Pressure', 'Evacuation'],
                disasterType: 'Multiple',
                category: 'quiz'
            },
            {
                id: 'survivalkit',
                title: 'Survival Kit Builder',
                description: 'Budget-based kit assembly game. Choose the right emergency supplies for different disaster scenarios.',
                icon: 'fas fa-toolbox',
                badge: 'Strategy',
                players: '1',
                duration: '15-25',
                rating: '★ 4.4',
                features: ['Budget Management', 'Item Selection', 'Scenario Based', 'Educational'],
                disasterType: 'Multiple',
                category: 'strategy'
            },
            {
                id: 'rescuemission',
                title: 'Rescue Mission Simulator',
                description: 'Role-play as first responders. Prioritize rescue tasks, help injured, and make critical decisions under pressure.',
                icon: 'fas fa-user-nurse',
                badge: 'Rescue',
                players: '1-3',
                duration: '20-35',
                rating: '★ 4.7',
                features: ['Role Playing', 'First Response', 'Time Management', 'Decision Making'],
                disasterType: 'Multiple',
                category: 'simulation'
            },
            {
                id: 'disastertrivia',
                title: 'Disaster Trivia Battle',
                description: 'Multiplayer quiz with rapid-fire disaster safety questions. Compete with power-ups and lifelines.',
                icon: 'fas fa-question-circle',
                badge: 'Quiz',
                players: '2-8',
                duration: '15-25',
                rating: '★ 4.5',
                features: ['Multiplayer', 'Quiz', 'Power-ups', 'Competitive'],
                disasterType: 'Multiple',
                category: 'quiz'
            },
            {
                id: 'virtualdrill',
                title: 'Virtual Drill Race',
                description: 'Conduct evacuation drills for schools and communities. Guide groups to safety while managing obstacles and panic.',
                icon: 'fas fa-running',
                badge: 'Drill',
                players: '1-2',
                duration: '15-25',
                rating: '★ 4.6',
                features: ['Evacuation', 'Group Management', 'Obstacle Navigation', 'Time Pressure'],
                disasterType: 'Multiple',
                category: 'simulation'
            },
            {
                id: 'factVsMyth',
                title: 'Disaster Detective',
                description: 'Mystery game investigating disaster myths and facts. Solve cases by distinguishing truth from misinformation.',
                icon: 'fas fa-search',
                badge: 'Detective',
                players: '1',
                duration: '20-30',
                rating: '★ 4.7',
                features: ['Mystery', 'Fact Checking', 'Investigation', 'Education'],
                disasterType: 'Multiple',
                category: 'quiz'
            },
            {
                id: 'disasterpoly',
                title: 'DisasterPoly',
                description: 'Monopoly-style board game with disaster management twist. Buy properties, manage resources, and survive various disasters while building community resilience.',
                icon: 'fas fa-dice',
                badge: 'Board Game',
                players: '2-6',
                duration: '60-120',
                rating: '★ 4.8',
                features: ['Board Game', 'Resource Management', 'Property Development', 'Community Building'],
                disasterType: 'Multiple',
                category: 'strategy'
            },
            {
                id: 'knowledgequiz',
                title: 'Knowledge Quiz',
                description: 'Case study-based quiz featuring real disaster scenarios. Answer challenging questions based on actual emergency situations and expert analysis.',
                icon: 'fas fa-graduation-cap',
                badge: 'Case Study',
                players: '1',
                duration: '20-35',
                rating: '★ 4.6',
                features: ['Case Studies', 'Real Scenarios', 'Expert Analysis', 'Knowledge Testing'],
                disasterType: 'Multiple',
                category: 'quiz'
            }
        ];

        // Disaster information data
        const disasterInfo = {
            'Multiple': {
                title: 'Multiple Disaster Types',
                subtitle: 'General Preparedness Guidelines',
                sections: [
                    {
                        title: 'Before a Disaster',
                        icon: 'fas fa-clipboard-list',
                        items: [
                            'Create a family emergency plan with meeting points',
                            'Build an emergency kit with 3 days of supplies',
                            'Learn evacuation routes from your home and workplace',
                            'Stay informed about local risks and warning systems',
                            'Identify safe spots in your home for different disaster types',
                            'Keep important documents in a waterproof container'
                        ]
                    },
                    {
                        title: 'During a Disaster',
                        icon: 'fas fa-exclamation-triangle',
                        items: [
                            'Follow instructions from local authorities immediately',
                            'If indoors, stay away from windows and exterior walls',
                            'If outdoors, move to clear areas away from buildings and power lines',
                            'Use text messages to communicate (calls may not go through)',
                            'Stay calm and help others who may need assistance',
                            'Listen to battery-powered radio for emergency updates'
                        ]
                    },
                    {
                        title: 'After a Disaster',
                        icon: 'fas fa-home',
                        items: [
                            'Check for injuries and provide first aid if trained',
                            'Inspect your home for damage carefully before entering',
                            'Avoid using open flames (risk of gas leaks)',
                            'Listen to official information before returning home',
                            'Document damage with photos for insurance claims',
                            'Help neighbors and community members safely'
                        ]
                    }
                ]
            },
            'Tsunami': {
                title: 'Tsunami Preparedness',
                subtitle: 'Coastal Safety Guidelines',
                sections: [
                    {
                        title: 'Before a Tsunami',
                        icon: 'fas fa-clipboard-list',
                        items: [
                            'Know if you live in a tsunami hazard zone',
                            'Plan evacuation routes to high ground or inland',
                            'Practice your evacuation route with family',
                            'Have a waterproof bag with important documents',
                            'Learn natural warning signs: ground shaking, ocean receding',
                            'Identify sturdy buildings with multiple floors as backup shelter'
                        ]
                    },
                    {
                        title: 'During a Tsunami Warning',
                        icon: 'fas fa-exclamation-triangle',
                        items: [
                            'Move immediately to higher ground - do not wait',
                            'If you cannot get to high ground, go to an upper floor of a sturdy building',
                            'Stay away from the beach - never go to watch a tsunami',
                            'Follow evacuation routes - do not take shortcuts',
                            'If caught in water, grab onto something that floats',
                            'Stay out of the water and away from debris'
                        ]
                    },
                    {
                        title: 'After a Tsunami',
                        icon: 'fas fa-home',
                        items: [
                            'Stay away from flooded and damaged areas until officials say it is safe',
                            'Be aware that tsunamis are a series of waves - more may come',
                            'Check yourself for injuries and get first aid if needed',
                            'Help people who require special assistance',
                            'Avoid disaster areas - your presence might hamper rescue efforts',
                            'Listen to authorities about when it is safe to return'
                        ]
                    }
                ]
            },
            'Hurricane': {
                title: 'Hurricane Preparedness',
                subtitle: 'Storm Safety Guidelines',
                sections: [
                    {
                        title: 'Before Hurricane Season',
                        icon: 'fas fa-clipboard-list',
                        items: [
                            'Know your evacuation zone and plan your route',
                            'Trim trees and shrubs around your home',
                            'Install storm shutters or pre-cut plywood for windows',
                            'Clear loose and clogged rain gutters and downspouts',
                            'Review insurance policies and take inventory of belongings',
                            'Establish communication plan with family members'
                        ]
                    },
                    {
                        title: 'When a Hurricane is Approaching',
                        icon: 'fas fa-exclamation-triangle',
                        items: [
                            'Follow evacuation orders from local authorities',
                            'Secure your home and bring outdoor furniture inside',
                            'Turn off utilities if instructed to do so',
                            'Stay indoors during the hurricane, away from windows',
                            'Be aware of the eye - stay inside when winds calm temporarily',
                            'Monitor weather updates continuously'
                        ]
                    },
                    {
                        title: 'After the Hurricane',
                        icon: 'fas fa-home',
                        items: [
                            'Listen to officials for information and special instructions',
                            'Avoid flooded roads and washed out bridges',
                            'Stay away from loose or dangling power lines',
                            'Inspect your home for damage and take pictures for insurance',
                            'Use flashlights instead of candles to prevent fires',
                            'Drink only bottled or purified water'
                        ]
                    }
                ]
            },
            'Wildfire': {
                title: 'Wildfire Safety',
                subtitle: 'Fire Prevention and Response',
                sections: [
                    {
                        title: 'Before a Wildfire',
                        icon: 'fas fa-clipboard-list',
                        items: [
                            'Create defensible space around your home (30-100 feet)',
                            'Use fire-resistant materials for roofing and exterior',
                            'Clear leaves and debris from gutters, eaves, and roof',
                            'Have an emergency supply kit ready to go',
                            'Plan multiple evacuation routes from your area',
                            'Keep garden hoses connected and ladder accessible'
                        ]
                    },
                    {
                        title: 'During a Wildfire',
                        icon: 'fas fa-exclamation-triangle',
                        items: [
                            'Evacuate immediately if authorities say to do so',
                            'Wear protective clothing and footwear',
                            'Stay low to the ground in smoky conditions',
                            'Choose downhill escape routes - fire travels uphill faster',
                            'If trapped, call 911 and give your location',
                            'Find an area clear of vegetation and lie face down'
                        ]
                    },
                    {
                        title: 'After a Wildfire',
                        icon: 'fas fa-home',
                        items: [
                            'Return home only when officials say it is safe',
                            'Use caution when entering burned areas - hazards may exist',
                            'Check the roof and attic for hidden burning sparks',
                            'Document property damage with photographs',
                            'Beware of ash pits - they can burn for days',
                            'Watch for heat exhaustion and dehydration'
                        ]
                    }
                ]
            },
            'Earthquake': {
                title: 'Earthquake Safety',
                subtitle: 'Drop, Cover, and Hold On',
                sections: [
                    {
                        title: 'Before an Earthquake',
                        icon: 'fas fa-clipboard-list',
                        items: [
                            'Secure heavy furniture, appliances, and hanging objects',
                            'Identify safe spots in each room (under sturdy tables, against inside walls)',
                            'Practice "Drop, Cover, and Hold On" with family members',
                            'Keep a wrench near gas shutoff valve (if you have gas service)',
                            'Store emergency supplies in easy-to-access locations',
                            'Know how to turn off water, gas, and electricity'
                        ]
                    },
                    {
                        title: 'During an Earthquake',
                        icon: 'fas fa-exclamation-triangle',
                        items: [
                            'DROP to the ground (before the earthquake drops you)',
                            'COVER your head and neck with your arms and seek shelter',
                            'HOLD ON to your shelter (or your head and neck) until shaking stops',
                            'If outdoors, move to an open area away from buildings and power lines',
                            'If driving, pull over and stop away from overpasses and trees',
                            'If in bed, stay there and cover your head with a pillow'
                        ]
                    },
                    {
                        title: 'After an Earthquake',
                        icon: 'fas fa-home',
                        items: [
                            'Check yourself and others for injuries - provide first aid',
                            'Check for gas leaks and turn off gas if you smell it',
                            'Inspect your home for damage and be cautious of aftershocks',
                            'Listen to a battery-operated radio for emergency information',
                            'Open cabinets cautiously - contents may have shifted',
                            'Clean up hazardous spills and wear shoes to protect feet'
                        ]
                    }
                ]
            },
            'Flood': {
                title: 'Flood Safety',
                subtitle: 'Water Emergency Preparedness',
                sections: [
                    {
                        title: 'Before a Flood',
                        icon: 'fas fa-clipboard-list',
                        items: [
                            'Know your flood risk and elevation above flood stage',
                            'Install check valves in sewer traps to prevent backup',
                            'Waterproof your basement and elevate electrical components',
                            'Have sandbags, plywood, plastic sheeting available',
                            'Keep insurance policies and important documents in waterproof container',
                            'Identify higher ground evacuation routes'
                        ]
                    },
                    {
                        title: 'During a Flood',
                        icon: 'fas fa-exclamation-triangle',
                        items: [
                            'Move to higher ground immediately - do not wait for instructions',
                            'Avoid walking or driving through flood waters (6 inches can knock you down)',
                            'Stay away from downed power lines and report them',
                            'If your vehicle stalls in water, abandon it and seek higher ground',
                            'Never try to swim in flood waters',
                            'Stay out of moving water'
                        ]
                    },
                    {
                        title: 'After a Flood',
                        icon: 'fas fa-home',
                        items: [
                            'Return home only when authorities say it is safe',
                            'Avoid floodwaters - may be contaminated or electrically charged',
                            'Service damaged septic tanks and sewage systems immediately',
                            'Clean and disinfect everything that got wet',
                            'Throw away food that came in contact with flood water',
                            'Take pictures of damage for insurance claims'
                        ]
                    }
                ]
            }
        };

        // DOM elements
        const gamesGrid = document.getElementById('gamesGrid');
        const gameSearch = document.getElementById('gameSearch');
        const filterOptions = document.querySelectorAll('.filter-option');
        const disasterInfoModal = document.getElementById('disasterInfoModal');
        const closeDisasterModal = document.getElementById('closeDisasterModal');
        const disasterModalTitle = document.getElementById('disasterModalTitle');
        const disasterModalSubtitle = document.getElementById('disasterModalSubtitle');
        const disasterModalBody = document.getElementById('disasterModalBody');

        // Performance tracking system
        class DisasterPreparednessTracker {
            constructor() {
                this.storageKey = 'disaster_preparedness_data';
                this.sessionKey = 'current_session_data';
                this.data = this.loadData();
                this.sessionData = this.loadSessionData();
            }

            loadData() {
                const saved = localStorage.getItem(this.storageKey);
                if (saved) {
                    return JSON.parse(saved);
                }
                return {
                    totalGamesPlayed: 0,
                    totalScore: 0,
                    totalTime: 0,
                    gameResults: {},
                    categoryScores: {
                        naturalDisaster: { score: 0, attempts: 0, maxScore: 0 },
                        response: { score: 0, attempts: 0, maxScore: 0 },
                        preparedness: { score: 0, attempts: 0, maxScore: 0 },
                        decision: { score: 0, attempts: 0, maxScore: 0 }
                    },
                    lastPlayedDate: null,
                    achievements: [],
                    overallRating: 0,
                    personalityTraits: {
                        quickThinking: 0,
                        planning: 0,
                        teamwork: 0,
                        knowledgeRetention: 0,
                        stressManagement: 0
                    }
                };
            }

            loadSessionData() {
                const saved = sessionStorage.getItem(this.sessionKey);
                if (saved) {
                    return JSON.parse(saved);
                }
                return {
                    gamesPlayedThisSession: [],
                    improvementsSeen: false,
                    lastNotificationShown: null
                };
            }

            saveData() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.data));
                sessionStorage.setItem(this.sessionKey, JSON.stringify(this.sessionData));
            }

            recordGameResult(gameId, score, timeSpent, skillsAssessed) {
                const gameData = gamesData.find(g => g.id === gameId);
                if (!gameData) return;

                // Record game result
                if (!this.data.gameResults[gameId]) {
                    this.data.gameResults[gameId] = {
                        timesPlayed: 0,
                        bestScore: 0,
                        averageScore: 0,
                        totalScore: 0,
                        totalTime: 0,
                        lastPlayed: null,
                        improvement: 0
                    };
                }

                const gameResult = this.data.gameResults[gameId];
                const previousBest = gameResult.bestScore;

                gameResult.timesPlayed++;
                gameResult.totalScore += score;
                gameResult.totalTime += timeSpent;
                gameResult.averageScore = gameResult.totalScore / gameResult.timesPlayed;
                gameResult.lastPlayed = new Date().toISOString();

                if (score > gameResult.bestScore) {
                    gameResult.bestScore = score;
                    gameResult.improvement = score - previousBest;
                }

                // Update category scores
                this.updateCategoryScores(gameData, score, skillsAssessed);

                // Update overall statistics
                this.data.totalGamesPlayed++;
                this.data.totalScore += score;
                this.data.totalTime += timeSpent;
                this.data.lastPlayedDate = new Date().toISOString();

                // Update personality traits based on game performance
                this.updatePersonalityTraits(gameData, score, timeSpent, skillsAssessed);

                // Record session data
                this.sessionData.gamesPlayedThisSession.push({
                    gameId,
                    score,
                    timeSpent,
                    timestamp: new Date().toISOString(),
                    improved: gameResult.improvement > 0
                });

                // Calculate new overall rating
                this.calculateOverallRating();

                this.saveData();
            }

            updateCategoryScores(gameData, score, skillsAssessed) {
                const categoryMappings = {
                    'naturalDisaster': ['Tsunami', 'Hurricane', 'Wildfire', 'Earthquake', 'Flood'],
                    'response': ['simulation', 'rescue', 'first aid', 'evacuation'],
                    'preparedness': ['planning', 'resource management', 'supplies', 'kit building'],
                    'decision': ['strategy', 'quick decisions', 'crisis management', 'critical thinking']
                };

                for (const [category, keywords] of Object.entries(categoryMappings)) {
                    let relevanceScore = 0;

                    // Check disaster type relevance
                    if (keywords.includes(gameData.disasterType)) {
                        relevanceScore += 0.4;
                    }

                    // Check feature relevance
                    gameData.features.forEach(feature => {
                        if (keywords.some(keyword => feature.toLowerCase().includes(keyword.toLowerCase()))) {
                            relevanceScore += 0.2;
                        }
                    });

                    // Check skills assessed
                    if (skillsAssessed) {
                        skillsAssessed.forEach(skill => {
                            if (keywords.some(keyword => skill.toLowerCase().includes(keyword.toLowerCase()))) {
                                relevanceScore += 0.3;
                            }
                        });
                    }

                    if (relevanceScore > 0) {
                        const categoryData = this.data.categoryScores[category];
                        categoryData.attempts++;
                        categoryData.score += score * relevanceScore;
                        categoryData.maxScore = Math.max(categoryData.maxScore, score);
                    }
                }
            }

            updatePersonalityTraits(gameData, score, timeSpent, skillsAssessed) {
                const maxTime = 60; // minutes
                const timeRatio = Math.min(timeSpent / maxTime, 1);
                const scoreRatio = score / 100;

                // Quick thinking (faster completion with good score)
                if (timeSpent < 20 && score > 70) {
                    this.data.personalityTraits.quickThinking += 5;
                }

                // Planning (strategy games performance)
                if (gameData.category === 'strategy' && score > 75) {
                    this.data.personalityTraits.planning += 3;
                }

                // Teamwork (multiplayer games)
                if (gameData.category === 'multiplayer' && score > 65) {
                    this.data.personalityTraits.teamwork += 4;
                }

                // Knowledge retention (quiz games)
                if (gameData.category === 'quiz' && score > 80) {
                    this.data.personalityTraits.knowledgeRetention += 3;
                }

                // Stress management (high score in simulation games)
                if (gameData.category === 'simulation' && score > 70) {
                    this.data.personalityTraits.stressManagement += 2;
                }

                // Cap personality traits at 100
                Object.keys(this.data.personalityTraits).forEach(trait => {
                    this.data.personalityTraits[trait] = Math.min(this.data.personalityTraits[trait], 100);
                });
            }

            calculateOverallRating() {
                let totalWeight = 0;
                let weightedScore = 0;

                // Category performance (40% weight)
                Object.values(this.data.categoryScores).forEach(category => {
                    if (category.attempts > 0) {
                        const categoryScore = (category.score / category.attempts) / 10; // Normalize to 0-10
                        weightedScore += categoryScore * 0.1; // Each category gets 10% (40% total)
                        totalWeight += 0.1;
                    }
                });

                // Game diversity (20% weight)
                const uniqueGamesPlayed = Object.keys(this.data.gameResults).length;
                const diversityScore = Math.min(uniqueGamesPlayed / 10, 1) * 2; // Max 2 points for playing 10+ games
                weightedScore += diversityScore;
                totalWeight += 0.2;

                // Consistency (20% weight)
                const games = Object.values(this.data.gameResults);
                if (games.length > 2) {
                    const averageScore = games.reduce((sum, game) => sum + game.averageScore, 0) / games.length;
                    const consistencyScore = (averageScore / 100) * 2; // Max 2 points
                    weightedScore += consistencyScore;
                    totalWeight += 0.2;
                }

                // Improvement trend (20% weight)
                const recentGames = this.sessionData.gamesPlayedThisSession.slice(-5);
                if (recentGames.length > 1) {
                    const improvementCount = recentGames.filter(game => game.improved).length;
                    const improvementScore = (improvementCount / recentGames.length) * 2; // Max 2 points
                    weightedScore += improvementScore;
                    totalWeight += 0.2;
                }

                // Calculate final rating (0-10 scale)
                this.data.overallRating = totalWeight > 0 ? Math.min(weightedScore, 10) : 0;
            }

            getOverallRating() {
                return {
                    score: Math.round(this.data.overallRating * 10) / 10,
                    label: this.getRatingLabel(this.data.overallRating),
                    description: this.getRatingDescription(this.data.overallRating)
                };
            }

            getRatingLabel(score) {
                if (score >= 9) return "Disaster Response Expert";
                if (score >= 8) return "Highly Prepared";
                if (score >= 7) return "Well Prepared";
                if (score >= 6) return "Adequately Prepared";
                if (score >= 5) return "Moderately Prepared";
                if (score >= 4) return "Basic Preparation";
                if (score >= 3) return "Learning in Progress";
                if (score >= 2) return "Building Foundation";
                if (score >= 1) return "Getting Started";
                return "Just Beginning";
            }

            getRatingDescription(score) {
                if (score >= 9) return "You demonstrate exceptional disaster preparedness skills and could effectively lead others during emergencies.";
                if (score >= 8) return "You have strong disaster preparedness knowledge and would handle most emergency situations very well.";
                if (score >= 7) return "You show good understanding of disaster response and could handle many emergency scenarios effectively.";
                if (score >= 6) return "You have a solid foundation in disaster preparedness with room for some improvement.";
                if (score >= 5) return "You understand basic disaster concepts but could benefit from more practice in specific areas.";
                if (score >= 4) return "You're developing disaster preparedness skills but need more comprehensive training.";
                if (score >= 3) return "You're making progress in learning disaster preparedness - keep practicing to improve.";
                if (score >= 2) return "You're building fundamental knowledge - focus on consistent practice across different disaster types.";
                if (score >= 1) return "You're beginning your disaster preparedness journey - try playing different types of games to build skills.";
                return "Start playing games to develop your disaster preparedness skills and knowledge.";
            }

            getCategoryProgress() {
                const categories = {};
                Object.entries(this.data.categoryScores).forEach(([key, category]) => {
                    if (category.attempts > 0) {
                        const percentage = Math.min((category.score / category.attempts) / 100 * 100, 100);
                        categories[key] = {
                            percentage: Math.round(percentage),
                            score: category.score / category.attempts,
                            attempts: category.attempts
                        };
                    } else {
                        categories[key] = { percentage: 0, score: 0, attempts: 0 };
                    }
                });
                return categories;
            }

            getPersonalizedInsights() {
                const insights = [];
                const categoryProgress = this.getCategoryProgress();
                const traits = this.data.personalityTraits;

                // Analyze strengths
                const strongCategories = Object.entries(categoryProgress)
                    .filter(([key, data]) => data.percentage >= 70)
                    .map(([key]) => key);

                const weakCategories = Object.entries(categoryProgress)
                    .filter(([key, data]) => data.percentage < 50 && data.attempts > 0)
                    .map(([key]) => key);

                if (strongCategories.length > 0) {
                    const categoryNames = {
                        naturalDisaster: "natural disaster response",
                        response: "emergency response",
                        preparedness: "disaster preparedness",
                        decision: "decision making under pressure"
                    };

                    insights.push({
                        type: 'strength',
                        icon: 'fas fa-check-circle',
                        text: `Strong performance in ${strongCategories.map(c => categoryNames[c]).join(', ')}. You show excellent skills in these areas!`
                    });
                }

                if (weakCategories.length > 0) {
                    const categoryNames = {
                        naturalDisaster: "natural disaster response",
                        response: "emergency response",
                        preparedness: "disaster preparedness",
                        decision: "decision making under pressure"
                    };

                    insights.push({
                        type: 'improvement',
                        icon: 'fas fa-lightbulb',
                        text: `Focus on improving ${weakCategories.map(c => categoryNames[c]).join(', ')} by playing more related games.`
                    });
                }

                // Personality trait insights
                const topTrait = Object.entries(traits).reduce((max, [key, value]) =>
                    value > max.value ? { key, value } : max, { key: '', value: 0 });

                if (topTrait.value >= 50) {
                    const traitNames = {
                        quickThinking: "quick thinking under pressure",
                        planning: "strategic planning and preparation",
                        teamwork: "collaborative emergency response",
                        knowledgeRetention: "disaster knowledge retention",
                        stressManagement: "stress management during crises"
                    };

                    insights.push({
                        type: 'strength',
                        icon: 'fas fa-star',
                        text: `Your strongest trait is ${traitNames[topTrait.key]}. This is valuable for emergency situations!`
                    });
                }

                // Game diversity insight
                const uniqueGames = Object.keys(this.data.gameResults).length;
                if (uniqueGames < 5) {
                    insights.push({
                        type: 'improvement',
                        icon: 'fas fa-gamepad',
                        text: `Try playing more different types of games (${uniqueGames}/19 played) to develop well-rounded disaster preparedness skills.`
                    });
                }

                // Recent improvement insight
                const recentImprovements = this.sessionData.gamesPlayedThisSession.filter(g => g.improved).length;
                if (recentImprovements > 0) {
                    insights.push({
                        type: 'improvement',
                        icon: 'fas fa-trending-up',
                        text: `Great job! You've improved your scores in ${recentImprovements} game(s) this session. Keep up the good work!`
                    });
                }

                if (insights.length === 0) {
                    insights.push({
                        type: 'neutral',
                        icon: 'fas fa-play',
                        text: 'Start playing games to receive personalized insights about your disaster preparedness skills!'
                    });
                }

                return insights;
            }

            shouldShowNotification() {
                const lastPlayed = this.data.lastPlayedDate;
                if (!lastPlayed) return false;

                const daysSinceLastPlay = (new Date() - new Date(lastPlayed)) / (1000 * 60 * 60 * 24);

                // Show notification if returning after a break or if there are improvements
                return daysSinceLastPlay > 1 || this.sessionData.gamesPlayedThisSession.some(g => g.improved);
            }

            getReturnNotification() {
                const recentImprovements = this.sessionData.gamesPlayedThisSession.filter(g => g.improved);
                const overallRating = this.getOverallRating();

                if (recentImprovements.length > 0) {
                    const gameNames = recentImprovements.map(g => {
                        const game = gamesData.find(game => game.id === g.gameId);
                        return game ? game.title : g.gameId;
                    });

                    return {
                        type: 'improvement',
                        title: 'Excellent Progress!',
                        content: `Welcome back! You've improved your performance in ${gameNames.join(', ')}. Your disaster preparedness rating is now ${overallRating.score}/10 (${overallRating.label}). ${overallRating.description}`
                    };
                }

                if (this.data.totalGamesPlayed > 0) {
                    return {
                        type: 'welcome',
                        title: 'Welcome Back!',
                        content: `Your current disaster preparedness rating is ${overallRating.score}/10 (${overallRating.label}). Continue playing games to improve your skills and knowledge.`
                    };
                }

                return null;
            }

            // Simulate game results for demonstration (remove in production)
            simulateGameResult(gameId) {
                const score = Math.floor(Math.random() * 40) + 60; // Random score between 60-100
                const timeSpent = Math.floor(Math.random() * 30) + 10; // Random time between 10-40 minutes
                const skills = ['problem solving', 'emergency response', 'critical thinking', 'planning'];
                const skillsAssessed = skills.slice(0, Math.floor(Math.random() * 3) + 1);

                this.recordGameResult(gameId, score, timeSpent, skillsAssessed);
                return { score, timeSpent, skillsAssessed };
            }
        }

        // Initialize performance tracker
        const performanceTracker = new DisasterPreparednessTracker();

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function () {
            loadUserInfo();
            initializeMenuNavigation();
            renderGameCards(gamesData);
            setupEventListeners();
            initializeAssessmentSystem();
        });

        // Initialize assessment system
        function initializeAssessmentSystem() {
            updatePerformanceDashboard();
            showReturnNotification();
        }

        // Update performance dashboard
        function updatePerformanceDashboard() {
            const overallRating = performanceTracker.getOverallRating();
            const categoryProgress = performanceTracker.getCategoryProgress();
            const insights = performanceTracker.getPersonalizedInsights();

            // Update overall rating
            document.getElementById('ratingScore').textContent = overallRating.score;
            document.getElementById('ratingLabel').textContent = overallRating.label;

            // Update category progress
            Object.entries(categoryProgress).forEach(([category, data]) => {
                const progressElement = document.getElementById(`${category}Progress`);
                const textElement = document.getElementById(`${category}Text`);

                if (progressElement && textElement) {
                    progressElement.style.width = `${data.percentage}%`;
                    textElement.textContent = `${data.percentage}%`;
                }
            });

            // Update insights
            updateInsights(insights);

            // Update rating circle color based on score
            updateRatingCircleColor(overallRating.score);
        }

        // Update insights display
        function updateInsights(insights) {
            const insightsContent = document.getElementById('insightsContent');

            if (insights.length === 0) {
                insightsContent.innerHTML = '<p>Play games to receive personalized insights about your disaster preparedness skills!</p>';
                return;
            }

            const insightsList = document.createElement('ul');
            insightsList.className = 'insights-list';

            insights.forEach(insight => {
                const listItem = document.createElement('li');
                listItem.className = insight.type;
                listItem.innerHTML = `
                    <i class="${insight.icon}"></i>
                    <span>${insight.text}</span>
                `;
                insightsList.appendChild(listItem);
            });

            insightsContent.innerHTML = '';
            insightsContent.appendChild(insightsList);
        }

        // Update rating circle color
        function updateRatingCircleColor(score) {
            const ratingCircle = document.querySelector('.rating-circle');

            if (score >= 8) {
                ratingCircle.style.background = 'linear-gradient(135deg, var(--secondary), #2e7d32)';
            } else if (score >= 6) {
                ratingCircle.style.background = 'linear-gradient(135deg, var(--primary), var(--primary-dark))';
            } else if (score >= 4) {
                ratingCircle.style.background = 'linear-gradient(135deg, var(--warning), #f57c00)';
            } else {
                ratingCircle.style.background = 'linear-gradient(135deg, var(--accent), #d32f2f)';
            }
        }

        // Show return notification
        function showReturnNotification() {
            const notification = performanceTracker.getReturnNotification();
            if (!notification) return;

            const dashboardElement = document.getElementById('assessmentDashboard');
            const notificationElement = document.createElement('div');
            notificationElement.className = `assessment-notification ${notification.type}`;

            notificationElement.innerHTML = `
                <div class="notification-header">
                    <i class="${getNotificationIcon(notification.type)}"></i>
                    <span>${notification.title}</span>
                </div>
                <div class="notification-content">
                    ${notification.content}
                </div>
            `;

            dashboardElement.appendChild(notificationElement);

            // Auto-hide after 10 seconds
            setTimeout(() => {
                notificationElement.style.opacity = '0';
                setTimeout(() => {
                    if (notificationElement.parentNode) {
                        notificationElement.parentNode.removeChild(notificationElement);
                    }
                }, 500);
            }, 10000);
        }

        // Get notification icon
        function getNotificationIcon(type) {
            switch (type) {
                case 'improvement': return 'fas fa-trophy';
                case 'welcome': return 'fas fa-hand-wave';
                case 'warning': return 'fas fa-exclamation-triangle';
                default: return 'fas fa-info-circle';
            }
        }

        // Enhanced play game function with assessment tracking
        function playGame(gameId) {
            // Show assessment notification
            showGameAssessmentNotification(gameId);

            // Create a comprehensive game launcher with all available games
            const gameUrls = {
                'simcity-disaster': 'games/simCity.html',
                'tsunamiescape': 'games/tsunamiEscape.html',
                'hurricanehero': 'games/hurricaneHero.html',
                'wildfirewatch': 'games/WildfireWatch.html',
                'quakeresponse': 'games/quackResponse.html',
                'floodplainproject': 'games/floodPain.html',
                'stopdisasters': 'games/StopDisasters.html',
                'disasterresponse': 'games/disasterResponseGame.html',
                'roadtosafety': 'games/roadtosafety.html',
                'disastermind': 'games/disasterMind.html',
                'floodquest': 'games/floodQuest.html',
                'disasterquest': 'games/disasterQuest.html',
                'survivalkit': 'games/survivalKit.html',
                'rescuemission': 'games/rescueMission.html',
                'disastertrivia': 'games/disasterTrivia.html',
                'virtualdrill': 'games/virtualDrill.html',
                'factVsMyth': 'games/factVsMyth.html',
                'disasterpoly': 'games/disasterpoly.html',
                'knowledgequiz': 'games/quiz.html'
            };

            if (gameUrls[gameId]) {
                // For demonstration, simulate a game result before navigation
                // In production, this would be handled by the actual game
                const result = performanceTracker.simulateGameResult(gameId);

                // Update the dashboard immediately to show changes
                setTimeout(() => {
                    updatePerformanceDashboard();
                    showGameCompletionNotification(gameId, result);
                }, 1000);

                // Navigate to game
                window.location.href = gameUrls[gameId];
            } else {
                alert(`${gameId} will be available soon! This is a demo version.`);
            }
        }

        // Show game assessment notification
        function showGameAssessmentNotification(gameId) {
            const gameData = gamesData.find(g => g.id === gameId);
            if (!gameData) return;

            const previousResult = performanceTracker.data.gameResults[gameId];
            if (previousResult && previousResult.timesPlayed > 0) {
                const dashboardElement = document.getElementById('assessmentDashboard');
                const notificationElement = document.createElement('div');
                notificationElement.className = 'assessment-notification improvement';

                notificationElement.innerHTML = `
                    <div class="notification-header">
                        <i class="fas fa-gamepad"></i>
                        <span>Game Assessment Active</span>
                    </div>
                    <div class="notification-content">
                        Starting ${gameData.title}... Your previous best score was ${Math.round(previousResult.bestScore)}. 
                        Try to beat it and improve your disaster preparedness skills!
                    </div>
                `;

                dashboardElement.appendChild(notificationElement);

                // Auto-hide after 5 seconds
                setTimeout(() => {
                    notificationElement.style.opacity = '0';
                    setTimeout(() => {
                        if (notificationElement.parentNode) {
                            notificationElement.parentNode.removeChild(notificationElement);
                        }
                    }, 500);
                }, 5000);
            }
        }

        // Show game completion notification
        function showGameCompletionNotification(gameId, result) {
            const gameData = gamesData.find(g => g.id === gameId);
            if (!gameData) return;

            const dashboardElement = document.getElementById('assessmentDashboard');
            const notificationElement = document.createElement('div');
            notificationElement.className = 'assessment-notification improvement';

            const overallRating = performanceTracker.getOverallRating();

            notificationElement.innerHTML = `
                <div class="notification-header">
                    <i class="fas fa-trophy"></i>
                    <span>Game Completed!</span>
                </div>
                <div class="notification-content">
                    Great job completing ${gameData.title}! Score: ${result.score}/100. 
                    Your disaster preparedness rating is now ${overallRating.score}/10. 
                    ${overallRating.description}
                </div>
            `;

            dashboardElement.appendChild(notificationElement);

            // Auto-hide after 8 seconds
            setTimeout(() => {
                notificationElement.style.opacity = '0';
                setTimeout(() => {
                    if (notificationElement.parentNode) {
                        notificationElement.parentNode.removeChild(notificationElement);
                    }
                }, 500);
            }, 8000);
        }

        // Add quick test function for demonstration
        function quickTestAssessment() {
            // Simulate playing several games with different results
            const testGames = ['simcity-disaster', 'tsunamiescape', 'hurricanehero', 'disastertrivia', 'survivalkit'];

            testGames.forEach((gameId, index) => {
                setTimeout(() => {
                    performanceTracker.simulateGameResult(gameId);
                    updatePerformanceDashboard();

                    if (index === testGames.length - 1) {
                        const notification = document.createElement('div');
                        notification.className = 'assessment-notification improvement';
                        notification.innerHTML = `
                            <div class="notification-header">
                                <i class="fas fa-chart-line"></i>
                                <span>Assessment Test Complete!</span>
                            </div>
                            <div class="notification-content">
                                Demo: Simulated playing 5 games to show the assessment system. 
                                Your rating has been updated based on the simulated performance!
                            </div>
                        `;

                        document.getElementById('assessmentDashboard').appendChild(notification);

                        setTimeout(() => {
                            notification.style.opacity = '0';
                            setTimeout(() => {
                                if (notification.parentNode) {
                                    notification.parentNode.removeChild(notification);
                                }
                            }, 500);
                        }, 5000);
                    }
                }, index * 500);
            });
        }

        // Add keyboard shortcut for testing (Ctrl+T)
        document.addEventListener('keydown', function (e) {
            if (e.ctrlKey && e.key === 't') {
                e.preventDefault();
                quickTestAssessment();
            }
        });

        async function loadUserInfo() {
            try {
                // First try to get user data from session/localStorage
                let userData = null;

                // Check localStorage for stored user data
                const localData = localStorage.getItem('resq_user') || localStorage.getItem('currentUser') || localStorage.getItem('user');
                if (localData) {
                    userData = JSON.parse(localData);
                }

                // If no local data or token exists, try to fetch from backend
                const token = localStorage.getItem('token') || localStorage.getItem('authToken') || localStorage.getItem('jwt');
                if (!userData && token) {
                    try {
                        const response = await fetch('http://localhost:5000/api/auth/current', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            userData = await response.json();
                            // Save to localStorage for future use
                            localStorage.setItem('resq_user', JSON.stringify(userData));
                        } else {
                            console.log('Failed to fetch user from backend:', response.status);
                        }
                    } catch (fetchError) {
                        console.log('Could not fetch user from backend:', fetchError.message);
                    }
                }

                if (userData) {
                    const firstName = userData.firstName || userData.name || userData.username || userData.email?.split('@')[0] || 'User';
                    const lastName = userData.lastName || '';
                    const fullName = lastName ? `${firstName} ${lastName}` : firstName;

                    // Update sidebar user profile
                    const userNameElement = document.getElementById('sidebarUserName');
                    const userAvatarElement = document.getElementById('userAvatar');

                    if (userNameElement) userNameElement.textContent = fullName;
                    if (userAvatarElement) userAvatarElement.textContent = firstName.charAt(0).toUpperCase();

                    console.log('User loaded:', fullName);
                } else {
                    // Fallback to default values
                    console.log('No user data found');
                    setDefaultUser();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                setDefaultUser();
            }
        }

        function setDefaultUser() {
            const userNameElement = document.getElementById('sidebarUserName');
            const userAvatarElement = document.getElementById('userAvatar');

            if (userNameElement) userNameElement.textContent = 'Guest User';
            if (userAvatarElement) userAvatarElement.textContent = 'G';
        }

        // Function to save user data (call this when user logs in)
        function saveUserData(userData) {
            try {
                localStorage.setItem('resq_user', JSON.stringify(userData));
                loadUserInfo(); // Refresh the display
                console.log('User data saved:', userData);
            } catch (error) {
                console.error('Error saving user data:', error);
            }
        }

        // Add hover effects for user profile
        function initializeUserProfile() {
            const userProfile = document.querySelector('.sidebar-user-profile');
            if (userProfile) {
                // Add hover effect only (no click navigation)
                userProfile.addEventListener('mouseenter', function () {
                    this.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                    this.style.borderRadius = '10px';
                    this.style.transition = 'all 0.2s ease';
                });

                userProfile.addEventListener('mouseleave', function () {
                    this.style.backgroundColor = 'transparent';
                });
            }
        }

        // Load user info when page loads
        document.addEventListener('DOMContentLoaded', function () {
            loadUserInfo();
            initializeUserProfile();
        });
        // Initialize menu navigation
        function initializeMenuNavigation() {
            const menuItems = document.querySelectorAll('.menu-item');

            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    const text = this.querySelector('span').textContent;
                    handleMenuNavigation(text);
                });
            });
        }

        function handleMenuNavigation(page) {
            const pageMap = {
                'Dashboard': 'dashboard-student.html',
                'Education Modules': 'education-modules.html',
                'Sandbox Simulator': 'sandbox-simulator.html',
                'Emergency Contacts': '../emergency_contacts.html',
                "Do's & Dont's": '../dos&donts.html',
                'Drill Schedule': '../drill_schedule.html',
                'Disaster Map': '../advanced-map.html',
                'AI Helper': 'chatbot.html',
                'Gamified Learning': 'gamified-learning.html',
                'Profile & Badges': 'profile-badges.html',
                'Settings': 'settings.html'
            };

            if (pageMap[page] && page !== 'Gamified Learning') {
                window.location.href = pageMap[page];
            }
        }

        // Render game cards
        function renderGameCards(games) {
            gamesGrid.innerHTML = '';

            if (games.length === 0) {
                gamesGrid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <p>No games found matching your search criteria.</p>
                    </div>
                `;
                return;
            }

            games.forEach(game => {
                const gameCard = createGameCard(game);
                gamesGrid.appendChild(gameCard);
            });
        }

        // Create individual game card
        function createGameCard(game) {
            const card = document.createElement('div');
            card.className = 'game-card';
            card.setAttribute('data-category', game.category);

            card.innerHTML = `
                <div class="game-header" style="background: linear-gradient(90deg, ${getRandomGradient()});">
                    <div class="game-badge">${game.badge}</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="${game.icon}"></i>
                        </div>
                    </div>
                </div>
                <div class="game-content">
                    <h3>${game.title}</h3>
                    <p>${game.description}</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">${game.players}</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${game.duration}</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${game.rating}</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        ${game.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="playGame('${game.id}')">
                            <i class="fas fa-play"></i> Play Game
                        </button>
                        <button class="btn-secondary" onclick="showDisasterInfo('${game.disasterType}')">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        // Get random gradient for game headers
        function getRandomGradient() {
            const gradients = [
                'var(--p1), var(--p6)',
                'var(--p2), var(--p7)',
                'var(--p3), var(--p4)',
                'var(--p5), var(--p6)',
                'var(--primary), var(--p1)',
                'var(--secondary), var(--p2)'
            ];

            return gradients[Math.floor(Math.random() * gradients.length)];
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search functionality
            gameSearch.addEventListener('input', handleSearch);

            // Filter functionality
            filterOptions.forEach(option => {
                option.addEventListener('click', handleFilter);
            });

            // Modal close functionality
            closeDisasterModal.addEventListener('click', closeModal);
            disasterInfoModal.addEventListener('click', function (e) {
                if (e.target === disasterInfoModal) {
                    closeModal();
                }
            });

            // Escape key to close modal
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
        }

        // Handle search functionality
        function handleSearch() {
            const searchTerm = gameSearch.value.toLowerCase();
            const filteredGames = gamesData.filter(game =>
                game.title.toLowerCase().includes(searchTerm) ||
                game.description.toLowerCase().includes(searchTerm) ||
                game.disasterType.toLowerCase().includes(searchTerm) ||
                game.features.some(feature => feature.toLowerCase().includes(searchTerm))
            );

            renderGameCards(filteredGames);
        }

        // Handle filter functionality
        function handleFilter(e) {
            // Remove active class from all options
            filterOptions.forEach(option => option.classList.remove('active'));

            // Add active class to clicked option
            e.target.classList.add('active');

            const filterValue = e.target.getAttribute('data-filter');

            let filteredGames;
            if (filterValue === 'all') {
                filteredGames = gamesData;
            } else {
                filteredGames = gamesData.filter(game => game.category === filterValue);
            }

            renderGameCards(filteredGames);
        }

        // Show disaster information
        function showDisasterInfo(disasterType) {
            const info = disasterInfo[disasterType];
            if (!info) return;

            disasterModalTitle.textContent = info.title;
            disasterModalSubtitle.textContent = info.subtitle;

            let bodyContent = '';

            // Add animated icon based on disaster type
            const animationIcons = {
                'Multiple': 'fas fa-shield-alt',
                'Tsunami': 'fas fa-water',
                'Hurricane': 'fas fa-wind',
                'Wildfire': 'fas fa-fire',
                'Earthquake': 'fas fa-house-damage',
                'Flood': 'fas fa-house-flood-water'
            };

            bodyContent += `
                <div class="disaster-animation">
                    <div class="animation-icon">
                        <i class="${animationIcons[disasterType] || 'fas fa-exclamation-triangle'}" style="color: var(--primary);"></i>
                    </div>
                    <p><strong>Learn how to stay safe during ${disasterType.toLowerCase()} disasters</strong></p>
                </div>
            `;

            // Add sections
            info.sections.forEach(section => {
                bodyContent += `
                    <div class="disaster-section">
                        <h4>
                            <i class="${section.icon}"></i>
                            ${section.title}
                        </h4>
                        <ul>
                            ${section.items.map(item => `
                                <li>
                                    <i class="fas fa-check-circle"></i>
                                    <span>${item}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            });

            disasterModalBody.innerHTML = bodyContent;
            disasterInfoModal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            disasterInfoModal.classList.remove('active');
        }
    </script>
</body>

</html>